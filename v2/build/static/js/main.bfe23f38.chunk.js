(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(e,t,n){},161:function(e,t,n){e.exports=n(352)},167:function(e,t,n){},352:function(e,t,n){"use strict";n.r(t);n(162);var a=n(0),r=n.n(a),s=n(25),o=n.n(s),i=(n(167),n(7)),l=n(8),c=n(12),u=n(10),d=n(6),h=n(11),m=n(1),p=n.n(m),v=n(3),f=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={id:"",name:"",balance:"",paymail:"",avatarUrl:""},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.userInfo.then(function(t){e.setState({id:t.id,name:t.name,balance:t.balance,paymail:t.paymail,avatarUrl:t.avatarUrl})})}},{key:"render",value:function(){return""===this.state.id?null:r.a.createElement("div",{className:"justify-content-end"},r.a.createElement("a",{href:"#",onClick:this.props.onUserClick,className:"navbar-collapse collapse",title:this.state.name},this.state.name,"   ",r.a.createElement("img",{className:"navbar-expand-sm avatar-small",src:this.state.avatarUrl})))}}]),t}(r.a.Component),g=n(22),b="400d496a282de4be9934f4a62c42975f";function y(){return w.apply(this,arguments)}function w(){return(w=Object(v.a)(p.a.mark(function e(){var t,n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(b),e.prev=1,t.requestAuthorization("auth.user_identity:read users.profiles:read users.balance:read","http://localhost:3000/login"),e.next=5,t.handleAuthorizationResponse();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:return e.next=12,t.getIdentity();case 12:return n=e.sent,a=n.id,e.abrupt("return",a);case 15:case"end":return e.stop()}},e,null,[[1,7]])}))).apply(this,arguments)}function E(){return k.apply(this,arguments)}function k(){return(k=Object(v.a)(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(b),e.prev=1,e.next=4,t.logOut();case 4:window.location.reload(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:case"end":return e.stop()}},e,null,[[1,7]])}))).apply(this,arguments)}function S(){return R.apply(this,arguments)}function R(){return(R=Object(v.a)(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(b),e.prev=1,e.next=4,t.isLoggedIn();case 4:return n=e.sent,e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function j(){return O.apply(this,arguments)}function O(){return(O=Object(v.a)(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(b),e.next=3,t.getIdentity();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var C=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},n.links=n.props.links.map(function(e,t){return r.a.createElement("li",{key:t,className:"nav-item"},r.a.createElement("button",{className:"btn btn-link nav-link",onClick:function(){return n.handleClick(t)}},e.title))}),n.handleClick=n.handleClick.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"handleClick",value:function(e){var t=this.props.links[e].navLocation;this.props.navFunction(t)}},{key:"render",value:function(){return r.a.createElement("ul",{className:"navbar-nav mr-auto"},this.links)}}]),t}(a.Component),D="400d496a282de4be9934f4a62c42975f",I=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={loggedIn:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;S().then(function(t){e.setState({loggedIn:t})})}},{key:"render",value:function(){return r.a.createElement("nav",{className:"navbar navbar-light bg-light navbar-expand-lg"},r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarContent","aria-controls":"navbarContent","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("i",{className:"material-icons"},"list")),r.a.createElement("a",{className:"navbar-brand",href:"/"},"True Reviews"),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarContent"},r.a.createElement(C,{links:this.props.navLocations,navFunction:this.props.navFunction})),r.a.createElement(f,{onUserClick:this.props.onUserClick,userInfo:x()}),r.a.createElement("ul",null),this.state.loggedIn?null:r.a.createElement("button",{className:"btn btn-link",onClick:y},"Login in with MB"),this.state.loggedIn?r.a.createElement("button",{className:"btn btn-link",onClick:E},"Log Out"):null)}}]),t}(a.Component);function x(){return N.apply(this,arguments)}function N(){return(N=Object(v.a)(p.a.mark(function e(){var t,n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(D),e.next=3,t.getIdentity();case 3:return n=e.sent,e.next=6,t.getValidAccessToken();case 6:return e.next=8,t.getUserProfile(n.id);case 8:return a=e.sent,console.log(a),e.next=12,t.getBalance(n.id);case 12:return r=e.sent,console.log(r),e.abrupt("return",{id:n.id,name:n.name,balance:r.amount,paymail:a.primaryPaymail,avatarUrl:a.avatarUrl});case 15:case"end":return e.stop()}},e)}))).apply(this,arguments)}var B=n(27),M=n(354),U=window.Jigs.RunInstance,L=window.Run,P=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={pubkey:"",moneyButtonID:"",showSpinner:!0,userReviews:[],userLocations:[],userTokens:0,topReviewers:[],userLoaded:!1,userDoesNotExist:!1,topReviewersLoaded:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.setState({moneyButtonID:t.id,showSpinner:!1})}),this.loadUserItems().then(function(t){e.setState({userLoaded:!0})})}},{key:"renderSpinner",value:function(){return this.state.showSpinner?r.a.createElement("div",{className:"container text-center"},r.a.createElement("p",null,"Loading User Information..."),r.a.createElement("div",{className:"spinner-grow"})):null}},{key:"renderPlaceHolder",value:function(){return this.state.showSpinner?null:r.a.createElement("div",{className:"container text-center"},r.a.createElement("h1",null,"True Reviews"),r.a.createElement("p",null,"The place for high-quality reviews!"))}},{key:"renderTopReviewers",value:function(){return this.state.topReviewersLoaded?r.a.createElement("div",{className:"container text-center"},r.a.createElement("h2",null,"Top True Reviewers!"),r.a.createElement(M.a,{striped:!0,bordered:!0,variant:"dark"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{"text-center":"true"},"User"),r.a.createElement("th",{"text-center":"true"},"Reputation"))),r.a.createElement("tbody",null,this.renderTopReviewersData()))):r.a.createElement("div",{class:"text-center"},r.a.createElement("p",null,"Loading top reviewers..."),r.a.createElement("div",{className:"spinner-grow"},r.a.createElement("span",{className:"sr-only"},"Loading...")))}},{key:"renderTopReviewersData",value:function(){return this.state.topReviewers.map(function(e,t){return r.a.createElement("tr",null,r.a.createElement("td",null,e.user),r.a.createElement("td",null,e.reputation))})}},{key:"getTopReviewers",value:function(){var e=this;""!==this.state.moneyButtonID&&!1!==this.state.userLoaded&&!0!==this.state.topReviewersLoaded&&this.loadTopReviewers().then(function(t){null!=t&&e.setState({topReviewers:t,topReviewersLoaded:!0})})}},{key:"loadTopReviewers",value:function(){var e=Object(v.a)(p.a.mark(function e(){var t,n,a,r,s,o,i,l,c,u,d,h,m,v,f;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return U.activate(),e.next=3,U.sync();case 3:if(null!=(t=U.owner.jigs.find(function(e){return"UserDB"===e.constructor.name}))){e.next=6;break}return e.abrupt("return",null);case 6:n=Object.entries(t),a=[],r=0,s=n;case 9:if(!(r<s.length)){e.next=32;break}if(o=s[r],i=Object(B.a)(o,2),l=i[0],c=i[1],"owner"!==l&&"satoshis"!==l&&"location"!==l&&"origin"!==l){e.next=16;break}return e.abrupt("continue",29);case 16:return(u=new L({network:"main",owner:c.privKey,purse:"Kyt9WKt8XTymzwyQcwQeWtpEoELNHgkiwwbCFuBBHLWVPrjo7xBV"})).activate(),e.next=20,u.sync();case 20:for(d=0,h=u.owner.jigs,m=0;m<h.length;m++)"TrueReviewToken"===h[m].constructor.name&&(d+=h[m].amount);return v=new g.a("400d496a282de4be9934f4a62c42975f"),e.next=26,v.getUserProfile(l);case 26:f=e.sent,console.log(f),a.push({user:f.name,reputation:d});case 29:r++,e.next=9;break;case 32:return a.sort(function(e,t){return t.reputation-e.reputation}),e.abrupt("return",a.slice(0,3));case 34:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"renderUserItems",value:function(){return console.log("here: "+this.state.userDoesNotExist),""===this.state.moneyButtonID||this.state.userDoesNotExist?null:this.state.userLoaded?r.a.createElement("div",{className:"container text-center"},r.a.createElement("h2",null,"Your True Review Statistics"),r.a.createElement("h3",null,"Review Count: ",this.state.userReviews.length),r.a.createElement("h3",null,"Location Count: ",this.state.userLocations.length),r.a.createElement("h3",null,"Reputation: ",this.state.userTokens)):r.a.createElement("div",{class:"text-center"},r.a.createElement("p",null,"Loading user stats..."),r.a.createElement("div",{className:"spinner-grow"},r.a.createElement("span",{className:"sr-only"},"Loading...")))}},{key:"loadUserItems",value:function(){var e=Object(v.a)(p.a.mark(function e(){var t=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.userLoaded){e.next=2;break}return e.abrupt("return",null);case 2:console.log("loading user items"),fetch("/users/"+this.state.moneyButtonID).then(function(e){if(console.log(e.status),404===e.status)return t.setState({userDoesNotExist:!0,userLoaded:!0}),void console.log(t.state.userDoesNotExist);e.json()}).then(function(e){return t.setState({userReviews:e.reviews,userLocations:e.locations,userTokens:e.tokens,userLoaded:!0})});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"jumbotron jumbotron-fluid tr-brand-jumbotron"},this.renderSpinner(),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},this.renderPlaceHolder()),r.a.createElement("hr",null),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},this.renderUserItems()),r.a.createElement("div",{className:"col"},this.renderTopReviewers()))))}}]),t}(a.Component),T=n(356),F=n(357),A=n(38),q=n.n(A),J=n(151);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var z={position:"absolute",width:20,height:20,left:-10,top:-10,border:"5px solid red",borderRadius:20,backgroundColor:"white",textAlign:"center",color:"red",fontSize:11,fontWeight:"bold",padding:4},W=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){Object(J.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},z,{border:"5px solid blue",borderRadius:100,width:100,height:100,padding:12}),H=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={placeDescription:e.name,hover:e.$hover},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.setState({hover:this.props.$hover})}},{key:"componentDidUpdate",value:function(){this.state.hover!==this.props.$hover&&this.setState({hover:this.props.$hover})}},{key:"render",value:function(){var e=this.state.hover?W:z;if(null===this.state.placeDescription)return null;var t=this.state.placeDescription;return e===z&&(t=""),r.a.createElement("div",{style:e},t)}}]),t}(r.a.Component),K=n(50),V=n(49),Q=(window.Jigs.Review,window.Jigs.Location,window.Jigs.AllLocations,window.Jigs.RunInstance,"AIzaSyDMqrI8hMqiyIPdQUkRUerdohx28Fuv4wE"),Y=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=n.handleSubmit.bind(Object(d.a)(n)),n.handleSelectSuggest=n.handleSelectSuggest.bind(Object(d.a)(n)),n.handleNoResult=n.handleNoResult.bind(Object(d.a)(n)),n.handleStatusUpdatStatusUpdatee=n.handleStatusUpdate.bind(Object(d.a)(n)),n.handleLocationChange=n.handleLocationChange.bind(Object(d.a)(n)),n.handleLocationTypeChange=n.handleLocationTypeChange.bind(Object(d.a)(n)),n.handleReviewBodyChange=n.handleReviewBodyChange.bind(Object(d.a)(n)),n.handleReviewRatingChange=n.handleReviewRatingChange.bind(Object(d.a)(n)),n.handleFormChange=n.handleFormChange.bind(Object(d.a)(n)),n.closeModal=n.closeModal.bind(Object(d.a)(n)),n.state={badInput:!1,type:"",name:"",body:"",search:"",placeID:"",placeDescription:"",address:"",rating:"",moneyButtonID:"",moneyButtonName:"",reviewTx:"",coords:{lat:59.93,lng:30.33},renderMap:!1,submitted:!1,renderMB:!1,validForm:!1,renderSuccessModal:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"closeModal",value:function(){this.setState({renderSuccessModal:!1})}},{key:"renderSubmissionModal",value:function(){return!1===this.state.renderSuccessModal?null:r.a.createElement(T.a.Dialog,null,r.a.createElement(T.a.Header,{closeButton:!0},r.a.createElement(T.a.Title,null,"Successfully created a review!")),r.a.createElement(T.a.Body,null,r.a.createElement("p",null,"Congratulations! You have earned 1 reputation point. Thanks for reviewing ",this.state.placeDescription)),r.a.createElement(T.a.Footer,null,r.a.createElement(F.a,{onClick:this.closeModal,variant:"secondary"},"Close"),r.a.createElement(F.a,{variant:"primary"},"View Review")))}},{key:"handleSubmit",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),fetch("/review/"+this.state.placeID,{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({locationName:this.state.placeDescription,coords:this.state.coords,reviewBody:this.state.body,rating:this.state.rating,userID:this.state.moneyButtonID})}).then(function(e){return e.json()}).then(function(e){n.setState({renderSuccessModal:!0}),console.log(e)});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderSubmitButton",value:function(){return console.log(this.state.moneyButtonID),""===this.state.moneyButtonID||this.state.badInput?r.a.createElement(F.a,{variant:"primary",type:"submit",disabled:!0},"Submit Review"):r.a.createElement(F.a,{variant:"primary",type:"submit"},"Submit Review")}},{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.setState({moneyButtonID:t.id,moneyButtonName:t.name})})}},{key:"handleLocationChange",value:function(e){this.setState({search:e.target.value,address:e.target.value,placeDescription:e.target.value})}},{key:"handleLocationTypeChange",value:function(e){this.setState({type:e.target.value})}},{key:"handleReviewBodyChange",value:function(e){this.setState({body:e.target.value})}},{key:"handleReviewRatingChange",value:function(e){e.preventDefault(),console.log(e.target.value),this.setState({rating:e.target.value}),console.log(this.state),console.log(""===this.state.rating)}},{key:"handleFormChange",value:function(e){""===this.state.placeID||this.state.body,""===this.state.rating?this.setState({renderMB:!1,validForm:!1}):this.setState({renderMB:!0,validForm:!0})}},{key:"handleSelectSuggest",value:function(e,t){this.setState({badInput:!1}),this.setState({renderMap:!0}),this.setState({coords:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}}),console.log(t.description),this.setState({search:"",address:e.formatted_address,placeID:e.place_id,placeDescription:t.description})}},{key:"handleNoResult",value:function(){this.setState({badInput:!0}),console.log("No results for ",this.state.search)}},{key:"renderPlaceMap",value:function(){if(!this.state.renderMap)return null;return r.a.createElement("div",{className:"container text-center",style:{height:"50vh",width:"50%",justifyContent:"center",alignItems:"center"}},r.a.createElement(q.a,{bootstrapURLKeys:{key:Q},center:this.state.coords,defaultZoom:14},r.a.createElement(H,{lat:this.state.coords.lat,lng:this.state.coords.lng,name:this.state.placeDescription})))}},{key:"renderForm",value:function(){var e=this;return this.state.renderSuccessModal?null:r.a.createElement("form",{onSubmit:this.handleSubmit,onChange:this.handleFormChange},r.a.createElement("div",{className:"form-group",id:"reviewFormLocation"},r.a.createElement("label",null,"Location to Review"),r.a.createElement(K.a,{params:{key:Q,libraries:"places,geocode"},render:function(t){return t&&r.a.createElement(V.a,{googleMaps:t,autocompletionRequest:{input:e.state.search},onNoResult:e.handleNoResult,onSelectSuggest:e.handleSelectSuggest,onStatusUpdate:e.handleStatusUpdate,textNoResults:"Did not find any matching locations",customRender:function(e){return r.a.createElement("div",{className:"customWrapper"},e?e.description:"Did not find any matching locations")}},r.a.createElement("input",{className:"form-control",type:"text",autoComplete:"off",value:e.state.placeDescription,placeholder:"Search a location",onChange:e.handleLocationChange,required:!0}))}})),r.a.createElement("div",{className:"form-group",id:"reviewFormBody"},r.a.createElement("label",null,"Review Body"),r.a.createElement("textarea",{className:"form-control",rows:"3",onChange:this.handleReviewBodyChange,required:!0})),r.a.createElement("div",{className:"form-group",id:"reviewFormRating"},r.a.createElement("label",null,"Rating"),r.a.createElement("input",{className:"form-control",type:"number",min:"0",max:"10",step:".1",onInput:this.handleReviewRatingChange,required:!0})),this.renderSubmitButton())}},{key:"handleStatusUpdate",value:function(e){console.log(e)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",null,this.renderForm(),this.renderSubmissionModal()),this.renderPlaceMap())}}]),t}(r.a.Component);var Z=function(){return r.a.createElement("div",{className:"jumbotron jumbotron-transparent-25"},r.a.createElement(Y,null))},$=n(51),G=n(355),X=(window.Jigs.RunInstance,function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).upvoteReview=n.upvoteReview.bind(Object(d.a)(n)),n.state={reviews:[],renderVoteModal:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.reviews.then(function(t){e.setState({reviews:t})})}},{key:"componentDidUpdate",value:function(e){var t=this;this.props.reviews.then(function(e){if(null==e||null===e)return null;e.length!==t.state.reviews.length&&t.setState({reviews:e})})}},{key:"upvoteReview",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/review/"+t+"/upvote",{method:"post"});case 2:return n=e.sent,e.next=5,n.json();case 5:e.sent;case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderTableData",value:function(){var e=this;return null==this.state.reviews?null:this.state.reviews.map(function(t,n){return console.log(t),r.a.createElement("tr",null,r.a.createElement("td",null,t.body),r.a.createElement("td",null,t.rating),r.a.createElement("td",null,t.user),r.a.createElement("td",null,r.a.createElement(F.a,{variant:"primary",size:"sm",onClick:function(){return e.upvoteReview(t.origin)}},"Great Review!")),r.a.createElement("td",{"text-center":"true"},r.a.createElement($.a,{to:t.user,amount:"1",currency:"USD"})))})}},{key:"render",value:function(){return r.a.createElement(G.a,{fluid:!0},r.a.createElement(M.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{"text-center":"true"},"Body"),r.a.createElement("th",{"text-center":"true"},"Rating"),r.a.createElement("th",{"text-center":"true"},"User"),r.a.createElement("th",{"text-center":"true"},"Vote"),r.a.createElement("th",{"text-center":"true"},"Tip"))),r.a.createElement("tbody",null,this.renderTableData())))}}]),t}(r.a.Component)),ee=(n(146),n(158)),te=(window.Jigs.RunInstance,function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleMapClick=n.handleMapClick.bind(Object(d.a)(n)),n.state={userID:"",showMap:!0,loggedIn:!1,places:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.setState({userID:t.id})}),S().then(function(t){e.setState({loggedIn:t})}),this.getAllPlaces().then(function(t){e.setState({places:t})})}},{key:"handleMapClick",value:function(e){console.log(this.state.places[e])}},{key:"renderReviewTable",value:function(){return this.state.showMap?null:r.a.createElement(X,{reviews:this.getAllPlaces()})}},{key:"renderMap",value:function(){var e={lat:35.7,lng:-78.7},t=4;if(null!==this.props.coords&&(e={lat:this.props.coords.latitude,lng:this.props.coords.longitude},t=14,console.log(this.props.coords.latitude)),!this.state.showMap)return null;for(var n=this.state.places,a=[],s=0;s<n.length;s++){console.log(n[s].coords);var o=n[s].coords;a[s]=r.a.createElement(H,{lat:o.lat,lng:o.lng,name:n[s].locationName,key:s})}return r.a.createElement("div",{className:"container text-center",style:{height:"50vh",width:"50%"}},r.a.createElement(q.a,{bootstrapURLKeys:{key:"AIzaSyDMqrI8hMqiyIPdQUkRUerdohx28Fuv4wE"},defaultCenter:e,defaultZoom:t,onChildClick:this.handleMapClick,hoverDistance:40},a))}},{key:"getAllPlaces",value:function(){return function(){return ne.apply(this,arguments)}().then(function(e){return e})}},{key:"render",value:function(){return r.a.createElement(G.a,null,r.a.createElement("div",null,r.a.createElement("div",null,this.renderReviewTable(),this.renderMap())))}}]),t}(r.a.Component));function ne(){return(ne=Object(v.a)(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/locations").then(function(e){return e.json()}).then(function(e){return console.log(e),e}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ae=Object(ee.geolocated)({positionOptions:{enableHighAccuracy:!1},userDecisionTimeout:5e3})(te),re=(window.Jigs.RunInstance,function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleSelectSuggest=n.handleSelectSuggest.bind(Object(d.a)(n)),n.handleInputChange=n.handleInputChange.bind(Object(d.a)(n)),n.handleClaimSubmit=n.handleClaimSubmit.bind(Object(d.a)(n)),n.transferLocation=n.transferLocation.bind(Object(d.a)(n)),n.state={search:"",placeID:"",reviewList:[],placeDescription:"",address:"",moneyButtonID:"",moneyButtonName:"",locationSelected:!1,renderModal:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.setState({moneyButtonID:t.id,moneyButtonName:t.name})})}},{key:"handleInputChange",value:function(e){this.setState({search:e.target.value,address:e.target.value,placeDescription:e.target.value})}},{key:"handleSelectSuggest",value:function(e,t){console.log(e,t),console.log(t.description),this.setState({search:"",address:e.formatted_address,placeID:e.place_id,placeDescription:t.description,locationSelected:!0})}},{key:"handleNoResult",value:function(){console.log("No results for ",this.state.search),this.setState({locationSelected:!1})}},{key:"handleStatusUpdate",value:function(e){console.log(e)}},{key:"renderReviewTable",value:function(){return this.state.locationSelected?r.a.createElement(X,{reviews:(e=this.state.placeID,fetch("/locations/"+e).then(function(e){if(404===e.status)throw"Location not found";return e.json()}).then(function(e){return e.reviews}))}):null;var e}},{key:"handleClaimSubmit",value:function(){this.setState({renderModal:!0})}},{key:"renderClaimBusinessButton",value:function(){return!1===this.state.locationSelected||""===this.state.moneyButtonID?null:r.a.createElement("div",{className:"container text-center"},r.a.createElement(F.a,{onClick:this.handleClaimSubmit,type:"submit",variant:"primary",size:"lg"},"Claim Location"))}},{key:"transferLocation",value:function(){var e=Object(v.a)(p.a.mark(function e(){var t=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.state.placeID){e.next=3;break}return console.error("No place selected"),e.abrupt("return");case 3:fetch("/locations/"+this.state.placeID+"/transfer",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({businessID:this.state.moneyButtonID})}).then(function(e){return e.json()}).then(function(e){t.setState({renderSuccessModal:!0}),console.log(e)});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"renderClaimModal",value:function(){return this.state.renderModal?r.a.createElement(T.a.Dialog,null,r.a.createElement(T.a.Header,{closeButton:!0},r.a.createElement(T.a.Title,null,"This is your location?")),r.a.createElement(T.a.Body,null,r.a.createElement("p",null,"Please be certain you are the business owner of this location. We will KYC you to ensure users are not squatting locations.")),r.a.createElement(T.a.Footer,null,r.a.createElement(F.a,{variant:"secondary"},"Close"),r.a.createElement(F.a,{onClick:this.transferLocation,variant:"primary"},"Claim Location"))):null}},{key:"render",value:function(){var e=this;return r.a.createElement(G.a,null,r.a.createElement(K.a,{params:{key:"AIzaSyDMqrI8hMqiyIPdQUkRUerdohx28Fuv4wE",libraries:"places,geocode"},render:function(t){return t&&r.a.createElement(V.a,{googleMaps:t,autocompletionRequest:{input:e.state.search},onNoResult:e.handleNoResult,onSelectSuggest:e.handleSelectSuggest,onStatusUpdate:e.handleStatusUpdate,textNoResults:"My custom no results text",customRender:function(e){return r.a.createElement("div",{className:"customWrapper"},e?e.description:"My custom no results text")}},r.a.createElement("input",{className:"form-control",type:"text",value:e.state.placeDescription,placeholder:"Search a location",onChange:e.handleInputChange}))}}),this.renderClaimBusinessButton(),this.renderClaimModal(),this.renderReviewTable())}}]),t}(r.a.Component));window.Jigs.Review,window.Jigs.Location,window.Jigs.AllLocations,window.Jigs.RunInstance;var se=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleSubmit=n.handleSubmit.bind(Object(d.a)(n)),n.handleRedeemSubmit=n.handleRedeemSubmit.bind(Object(d.a)(n)),n.handleSelectSuggest=n.handleSelectSuggest.bind(Object(d.a)(n)),n.handleNoResult=n.handleNoResult.bind(Object(d.a)(n)),n.handleStatusUpdatStatusUpdatee=n.handleStatusUpdate.bind(Object(d.a)(n)),n.handleLocationChange=n.handleLocationChange.bind(Object(d.a)(n)),n.handleLocationTypeChange=n.handleLocationTypeChange.bind(Object(d.a)(n)),n.handleReviewBodyChange=n.handleReviewBodyChange.bind(Object(d.a)(n)),n.handleReviewRatingChange=n.handleReviewRatingChange.bind(Object(d.a)(n)),n.handleRedeemCodeChange=n.handleRedeemCodeChange.bind(Object(d.a)(n)),n.handleBusinessIDChange=n.handleBusinessIDChange.bind(Object(d.a)(n)),n.handleFormChange=n.handleFormChange.bind(Object(d.a)(n)),n.closeModal=n.closeModal.bind(Object(d.a)(n)),n.state={badInput:!1,type:"",name:"",body:"",search:"",placeID:"",placeDescription:"",address:"",rating:"",businessID:"",redeemCode:"",moneyButtonID:"",moneyButtonName:"",reviewTx:"",coords:{lat:59.93,lng:30.33},renderMap:!1,submitted:!1,renderMB:!1,validForm:!1,renderReviewForm:!1,renderRedeemForm:!0,invalidRedemptionCode:!1,renderSuccessModal:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"closeModal",value:function(){this.setState({renderSuccessModal:!1})}},{key:"renderSubmissionModal",value:function(){return!1===this.state.renderSuccessModal?null:r.a.createElement(T.a.Dialog,null,r.a.createElement(T.a.Header,{closeButton:!0},r.a.createElement(T.a.Title,null,"Successfully created a review!")),r.a.createElement(T.a.Body,null,r.a.createElement("p",null,"Congratulations! You have earned 1 reputation point. Thanks for reviewing ",this.state.placeDescription)),r.a.createElement(T.a.Footer,null,r.a.createElement(F.a,{onClick:this.closeModal,variant:"secondary"},"Close"),r.a.createElement(F.a,{variant:"primary"},"View Review")))}},{key:"handleSubmit",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),fetch("/review/"+this.state.placeID,{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({locationName:this.state.placeDescription,coords:this.state.coords,reviewBody:this.state.body,rating:this.state.rating,userID:this.state.moneyButtonID})}).then(function(e){return e.json()}).then(function(e){n.setState({renderSuccessModal:!0}),console.log(e)});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handleRedeemSubmit",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),fetch("/truereview/"+this.state.businessID+"/redeem",{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({code:this.state.redeemCode,userID:this.state.moneyButtonID,dryRun:!0})}).then(function(e){if(200!==e.status)throw"Invalid redemption code";return e.json()}).then(function(e){if(!e.redeemed)throw"Error redeeming code";console.log(e),n.setState({invalidRedemptionCode:!1,renderReviewForm:!0,renderRedeemForm:!1,placeID:e.placeID})}).catch(function(e){console.error(e),n.setState({invalidRedemptionCode:!0})});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"renderRedeemErrorMessage",value:function(){return this.state.invalidRedemptionCode?r.a.createElement("div",null,r.a.createElement("h1",null,"Invalid Redemption Code")):null}},{key:"renderRedeemSubmitButton",value:function(){return console.log(this.state.moneyButtonID),""===this.state.moneyButtonID||this.state.badInput?r.a.createElement(F.a,{variant:"primary",type:"submit",disabled:!0},"Redeem Code"):r.a.createElement(F.a,{variant:"primary",type:"submit"},"Redeem Code")}},{key:"renderSubmitButton",value:function(){return console.log(this.state.moneyButtonID),""===this.state.moneyButtonID||this.state.badInput?r.a.createElement(F.a,{variant:"primary",type:"submit",disabled:!0},"Submit Review"):r.a.createElement(F.a,{variant:"primary",type:"submit"},"Submit Review")}},{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.setState({moneyButtonID:t.id,moneyButtonName:t.name})})}},{key:"handleLocationChange",value:function(e){this.setState({search:e.target.value,address:e.target.value,placeDescription:e.target.value})}},{key:"handleLocationTypeChange",value:function(e){this.setState({type:e.target.value})}},{key:"handleReviewBodyChange",value:function(e){this.setState({body:e.target.value})}},{key:"handleRedeemCodeChange",value:function(e){this.setState({redeemCode:e.target.value})}},{key:"handleBusinessIDChange",value:function(e){this.setState({businessID:e.target.value})}},{key:"handleReviewRatingChange",value:function(e){e.preventDefault(),console.log(e.target.value),this.setState({rating:e.target.value}),console.log(this.state),console.log(""===this.state.rating)}},{key:"handleFormChange",value:function(e){""===this.state.placeID||this.state.body,""===this.state.rating?this.setState({renderMB:!1,validForm:!1}):this.setState({renderMB:!0,validForm:!0})}},{key:"handleSelectSuggest",value:function(e,t){this.setState({badInput:!1}),this.setState({renderMap:!0}),this.setState({coords:{lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}}),console.log(t.description),this.setState({search:"",address:e.formatted_address,placeID:e.place_id,placeDescription:t.description})}},{key:"handleNoResult",value:function(){this.setState({badInput:!0}),console.log("No results for ",this.state.search)}},{key:"renderPlaceMap",value:function(){if(!this.state.renderMap)return null;return r.a.createElement("div",{className:"container text-center",style:{height:"50vh",width:"50%",justifyContent:"center",alignItems:"center"}},r.a.createElement(q.a,{bootstrapURLKeys:{key:"AIzaSyDMqrI8hMqiyIPdQUkRUerdohx28Fuv4wE"},center:this.state.coords,defaultZoom:14},r.a.createElement(H,{lat:this.state.coords.lat,lng:this.state.coords.lng,name:this.state.placeDescription})))}},{key:"renderReviewForm",value:function(){return this.state.renderSuccessModal||!this.state.renderReviewForm?null:r.a.createElement("form",{onSubmit:this.handleSubmit,onChange:this.handleFormChange},r.a.createElement("div",{className:"form-group",id:"reviewFormBody"},r.a.createElement("label",null,"Review Body"),r.a.createElement("textarea",{className:"form-control",rows:"3",onChange:this.handleReviewBodyChange,required:!0})),r.a.createElement("div",{className:"form-group",id:"reviewFormRating"},r.a.createElement("label",null,"Rating"),r.a.createElement("input",{className:"form-control",type:"number",min:"0",max:"10",step:".1",onInput:this.handleReviewRatingChange,required:!0})),this.renderSubmitButton())}},{key:"renderRedeemForm",value:function(){return this.state.renderRedeemForm?r.a.createElement("form",{onSubmit:this.handleRedeemSubmit},r.a.createElement("div",{className:"form-group",id:"redeemFormBusinessID"},r.a.createElement("label",null,"Business Identity Code"),r.a.createElement("input",{className:"form-control",type:"text",onChange:this.handleBusinessIDChange,required:!0})),r.a.createElement("div",{className:"form-group",id:"redeemFormCode"},r.a.createElement("label",null,"Redemption Code"),r.a.createElement("input",{className:"form-control",type:"text",onChange:this.handleRedeemCodeChange,required:!0})),this.renderRedeemSubmitButton(),this.renderRedeemErrorMessage()):null}},{key:"handleStatusUpdate",value:function(e){console.log(e)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",null,this.renderReviewForm(),this.renderSubmissionModal(),this.renderRedeemForm()),this.renderPlaceMap())}}]),t}(r.a.Component),oe=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={user:{},userReviews:[],getUserDone:!1,businessLocations:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"getUserInformation",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/users/"+t);case 2:if(404!==(n=e.sent).status){e.next=5;break}return e.abrupt("return");case 5:return console.log(n.status),e.next=8,n.json();case 8:return a=e.sent,e.next=11,fetch("/review/user/"+t);case 11:return n=e.sent,e.next=14,n.json();case 14:return r=e.sent,e.abrupt("return",{user:a,reviews:r});case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;j().then(function(t){e.getUserInformation(t.id).then(function(t){console.log(t),e.setState({user:t.user,getUserDone:!0,userReviews:t.reviews,businessLocations:t.user.locations})})})}},{key:"loadBusinessLocations",value:function(){var e=Object(v.a)(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"renderSpinner",value:function(){return this.state.getUserDone?null:r.a.createElement("div",{className:"container text-center"},r.a.createElement("p",null,"Loading User Information..."),r.a.createElement("div",{className:"spinner-grow"}))}},{key:"renderBusinessAccount",value:function(){return console.log("here"),0===Object.entries(this.state.user).length?null:this.state.user.businessAccount?this.state.businessLocations.map(function(e,t){return console.log(e),r.a.createElement("div",{className:"container text-center"},r.a.createElement("div",{class:"card",styles:"width: 18rem;"},r.a.createElement("div",{class:"card-body"},r.a.createElement("h5",{class:"card-title"},e.name))))}):null}},{key:"renderUserReviews",value:function(){return 0===Object.entries(this.state.user).length?null:0===this.state.userReviews.length?null:(console.log(this.state.userReviews),this.state.userReviews.reviews.map(function(e,t){return r.a.createElement("div",{class:"card",styles:"width: 18rem;"},r.a.createElement("div",{class:"card-body"},r.a.createElement("h5",{class:"card-title"},e.locationName),r.a.createElement("h6",{class:"card-subtitle mb-2 text-right"},"Rating: ",e.rating),r.a.createElement("h6",{class:"card-subtitle mb-2 text-right"},"Score: ",e.points),r.a.createElement("p",{class:"card-text"},e.body)))}))}},{key:"renderUserInfo",value:function(){return 0===Object.entries(this.state.user).length?null:(console.log(this.state.user.reviews),r.a.createElement("div",null,r.a.createElement("h3",null,"Name: ",this.state.user.profile.name),r.a.createElement("h3",null,"Paymail: ",this.state.user.profile.primaryPaymail),r.a.createElement("h3",null,"Reputation: ",this.state.user.tokens)))}},{key:"render",value:function(){return r.a.createElement("div",{className:"container text-center"},r.a.createElement("div",null,r.a.createElement("h1",null,"My Profile"),r.a.createElement("hr",null),this.renderUserInfo(),this.renderSpinner()),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("h3",null,"My Reviews"),this.renderUserReviews()),r.a.createElement("div",{className:"col"},r.a.createElement("h3",null,"My Rewards"))),r.a.createElement("div",null,r.a.createElement("h1",null,"My Business Details"),this.renderBusinessAccount()))}}]),t}(a.Component),ie=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onUserClick=n.onUserClick.bind(Object(d.a)(n)),n.state={showPage:"home",navLocations:[{title:"Home",navLocation:"home"},{title:"Submit",navLocation:"submit"},{title:"Browse",navLocation:"browse"},{title:"Search",navLocation:"search"},{title:"Redeem",navLocation:"redeem"}]},n.navigate=n.navigate.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"navigate",value:function(e){this.setState({showPage:e})}},{key:"onUserClick",value:function(){console.log("parent"),this.setState({showPage:"profile"})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(I,{onUserClick:this.onUserClick,navFunction:this.navigate,navLocations:this.state.navLocations}),"home"===this.state.showPage?r.a.createElement(P,null):null,"submit"===this.state.showPage?r.a.createElement(Z,null):null,"browse"===this.state.showPage?r.a.createElement(ae,null):null,"search"===this.state.showPage?r.a.createElement(re,null):null,"redeem"===this.state.showPage?r.a.createElement(se,null):null,"profile"===this.state.showPage?r.a.createElement(oe,null):null)}}]),t}(a.Component),le=n(28),ce="400d496a282de4be9934f4a62c42975f",ue=(window.Jigs.UserDB,window.Jigs.RunInstance,function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).onPaymentSuccessUser=n.onPaymentSuccessUser.bind(Object(d.a)(n)),n.onPaymentSuccessBusiness=n.onPaymentSuccessBusiness.bind(Object(d.a)(n)),n.state={renderUserRegistration:!1,redirect:!1,user:{}},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("Login component did mount called"),function(){return de.apply(this,arguments)}().then(function(t){console.log(t),e.setState({user:t}),e.getUser(t)})}},{key:"renderRedirect",value:function(){return this.state.redirect?(console.log("Login redirect called"),r.a.createElement(le.a,{to:"/"})):null}},{key:"onPaymentSuccessUser",value:function(e){var t=this;console.log("Successfully paid"),this.createUser(!1).then(function(e){t.setState({redirect:!0})})}},{key:"onPaymentSuccessBusiness",value:function(e){var t=this;console.log("Successfully paid"),this.createUser(!0).then(function(e){t.setState({redirect:!0})})}},{key:"renderUserRegistration",value:function(){return this.state.renderUserRegistration?r.a.createElement("div",{className:"container text-center"},r.a.createElement("h1",null,"Welcome to TrueReviews ",this.state.user.profile.name,"!"),r.a.createElement("h2",null,"Please select the type of account you'd like to register:"),r.a.createElement($.a,{to:"truereviews@moneybutton.com",amount:"0.01",currency:"USD",label:"User",onPayment:this.onPaymentSuccessUser}),r.a.createElement($.a,{to:"truereviews@moneybutton.com",amount:"0.02",currency:"USD",label:"Business",onPayment:this.onPaymentSuccessBusiness})):null}},{key:"getUser",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/users/"+t.id);case 2:if(200!==(n=e.sent).status){e.next=6;break}return this.setState({redirect:!0}),e.abrupt("return");case 6:404===n.status&&this.setState({renderUserRegistration:!0});case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createUser",value:function(){var e=Object(v.a)(p.a.mark(function e(t){var n=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/users/"+this.state.user.id,{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify({profile:this.state.user.profile,businessAccount:t})}).then(function(e){return e.json()}).then(function(e){console.log(e),n.setState({redirect:!0})});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",null,this.renderUserRegistration(),this.renderRedirect())}}]),t}(r.a.Component));function de(){return(de=Object(v.a)(p.a.mark(function e(){var t,n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new g.a(ce),e.next=3,t.handleAuthorizationResponse();case 3:return e.next=5,t.getIdentity();case 5:return n=e.sent,e.next=8,t.getUserProfile(n.id);case 8:return a=e.sent,e.abrupt("return",{id:n.id,profile:a});case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}var he=n(86);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_MBOAUTHID:"400d496a282de4be9934f4a62c42975f",REACT_APP_UNWRITERAPIKEY:"17wKrLmWgkXa9gXWxTmSZzy7izSDndmYZf",REACT_APP_GOOGLE_API_KEY:"AIzaSyDMqrI8hMqiyIPdQUkRUerdohx28Fuv4wE"})),o.a.render(r.a.createElement(he.a,null,r.a.createElement("div",null,r.a.createElement(le.b,{path:"/",exact:!0,component:ie}),r.a.createElement(le.b,{path:"/login/",component:ue}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[161,1,2]]]);
//# sourceMappingURL=main.bfe23f38.chunk.js.map