module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(n,s,function(e){return t[e]}.bind(null,s));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";var n=r(5),s=r(23),o=Object.prototype.toString;function i(t){return"[object Array]"===o.call(t)}function a(t){return null!==t&&"object"==typeof t}function c(t){return"[object Function]"===o.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),i(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(null,t[s],s,t)}t.exports={isArray:i,isArrayBuffer:function(t){return"[object ArrayBuffer]"===o.call(t)},isBuffer:s,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===o.call(t)},isFile:function(t){return"[object File]"===o.call(t)},isBlob:function(t){return"[object Blob]"===o.call(t)},isFunction:c,isStream:function(t){return a(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,s=arguments.length;n<s;n++)u(arguments[n],r);return e},deepMerge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]="object"==typeof r?t({},r):r}for(var n=0,s=arguments.length;n<s;n++)u(arguments[n],r);return e},extend:function(t,e,r){return u(e,function(e,s){t[s]=r&&"function"==typeof e?n(e,r):e}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,r){const n=r(19),s=r(52),o=r(18),{Purse:i}=r(56),a=r(2),{Address:c,PrivateKey:u,PublicKey:h}=a;class f{constructor(t={}){this.version="0.3.1-alpha",this.network=t.network||"main",this.bsvNetwork="main"===this.network?"mainnet":"testnet";const e=typeof t.app;if("undefined"!==e&&"string"!==e)throw new Error("app must be a string");this.app=t.app||"",this.pb();try{const e=new u(t.owner,this.bsvNetwork);if(t.owner&&e.toString()!==t.owner.toString())throw new Error;this.owner={privkey:e,pubkey:e.publicKey,address:e.toAddress()}}catch(e){if("Private key network mismatch"===e.message)throw e;try{const e=new h(t.owner,this.bsvNetwork);this.owner={pubkey:e,address:e.toAddress()}}catch(e){try{this.owner={address:new c(t.owner,this.bsvNetwork)}}catch(e){if("Address has mismatched network type."===e.message)throw e;throw new Error(`invalid owner: ${t.owner}`)}}}"string"==typeof t.blockchain?this.blockchain=new n(this.network,t.blockchain):this.blockchain=t.blockchain||new n(this.network),"string"==typeof t.purse||void 0===t.purse||t.purse instanceof u||null===t.purse?this.purse=new i(new u(t.purse,this.bsvNetwork),this.blockchain):this.purse=t.purse,this.sa=new o(this),this.sandbox=t.sandbox||!0,"mock"===this.network&&this.blockchain.fund(this.purse.address,1e8),this.activate()}async sync(){return this.sa.sync()}beginTransaction(){return this.sa.begin(),this}endTransaction(){return this.sa.end(),this}async deploy(t){return this.checkActive(),f.code.deploy(t),await this.sync(),t.location}async load(t){return this.checkActive(),this.sa.load(t)}checkActive(){if(f.instance!==this)throw new Error("run instance is not active. call run.activate() first.")}activate(){return f.instance=this,a.Networks.defaultNetwork=this.bsvNetwork,f.code.activate(this.network),this}async code(){const t=new c(this.owner.address,this.bsvNetwork).toString(),e=await this.blockchain.utxos(t),r=await Promise.all(e.map(t=>this.blockchain.fetch(t.txid))),n=e.filter((t,e)=>"class"===o.ku(r[e],t.vout)),s=[];for(const t of n)s.push(await this.load(`${t.txid}_o${t.vout}`));return s}async jigs(){const t=new c(this.owner.address,this.bsvNetwork).toString(),e=await this.blockchain.utxos(t),r=await Promise.all(e.map(t=>this.blockchain.fetch(t.txid))),n=e.filter((t,e)=>"jig"===o.ku(r[e],t.vout)),s=[];for(const t of n)s.push(await this.load(`${t.txid}_o${t.vout}`));return s}async gg(t){return this.owner.privkey&&t.sign(this.owner.privkey),t}pb(){a.Networks.defaultNetwork=this.bsvNetwork;const t=a.Transaction.prototype.sign;a.Transaction.prototype.sign=function(...e){const r=a.Transaction.Input.prototype.isValidSignature;a.Transaction.Input.prototype.isValidSignature=()=>!0;const n=t.call(this,...e);return a.Transaction.Input.prototype.isValidSignature=r,n}}}f.code=new s,f.Jig=f.code.Jig,Object.defineProperty(f,"Token",{get:()=>r(57)}),global.Jig=f.Jig,t.exports=f},function(t,e){t.exports=require("bsv")},function(t,e,r){"use strict";var n=r(0);function s(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var o;if(r)o=r(e);else if(n.isURLSearchParams(e))o=e.toString();else{var i=[];n.forEach(e,function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),i.push(s(e)+"="+s(t))}))}),o=i.join("&")}if(o){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}},function(t,e,r){"use strict";var n=r(9);t.exports=function(t,e,r,s,o){var i=new Error(t);return n(i,e,r,s,o)}},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";var n=r(0),s=r(28),o={"Content-Type":"application/x-www-form-urlencoded"};function i(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var a,c={adapter:("undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?a=r(29):"undefined"!=typeof XMLHttpRequest&&(a=r(43)),a),transformRequest:[function(t,e){return s(e,"Accept"),s(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(i(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(i(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],function(t){c.headers[t]={}}),n.forEach(["post","put","patch"],function(t){c.headers[t]=n.merge(o)}),t.exports=c},function(t,e,r){"use strict";var n=r(4);t.exports=function(t,e,r){var s=r.config.validateStatus;!s||s(r.status)?t(r):e(n("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,s){return t.config=e,r&&(t.code=r),t.request=n,t.response=s,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,ck:this.ck,config:this.config,code:this.code}},t}},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e,r){var n=r(13),s=r(10),o=r(11),i=r(30),a=r(31).Writable,c=r(32)("follow-redirects"),u={GET:!0,HEAD:!0,OPTIONS:!0,TRACE:!0},h=Object.create(null);function f(t,e){a.call(this),t.headers=t.headers||{},this._options=t,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t.host&&(t.hostname||(t.hostname=t.host),delete t.host),e&&this.on("response",e);var r=this;if(this._onNativeResponse=function(t){r._processResponse(t)},!t.pathname&&t.path){var n=t.path.indexOf("?");n<0?t.pathname=t.path:(t.pathname=t.path.substring(0,n),t.search=t.path.substring(n))}this._performRequest()}function l(t){var e={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(t).forEach(function(s){var o=s+":",a=r[o]=t[s],u=e[s]=Object.create(a);u.request=function(t,s){return"string"==typeof t?(t=n.parse(t)).maxRedirects=e.maxRedirects:t=Object.assign({protocol:o,maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},t),t.nativeProtocols=r,i.equal(t.protocol,o,"protocol mismatch"),c("options",t),new f(t,s)},u.get=function(t,e){var r=u.request(t,e);return r.end(),r}}),e}["abort","aborted","error","socket","timeout"].forEach(function(t){h[t]=function(e){this._redirectable.emit(t,e)}}),f.prototype=Object.create(a.prototype),f.prototype.write=function(t,e,r){if(!("string"==typeof t||"object"==typeof t&&"length"in t))throw new Error("data should be a string, Buffer or Uint8Array");"function"==typeof e&&(r=e,e=null),0!==t.length?this._requestBodyLength+t.length<=this._options.maxBodyLength?(this._requestBodyLength+=t.length,this._requestBodyBuffers.push({data:t,encoding:e}),this._reRequest.write(t,e,r)):(this.emit("error",new Error("Request body larger than maxBodyLength limit")),this.abort()):r&&r()},f.prototype.end=function(t,e,r){"function"==typeof t?(r=t,t=e=null):"function"==typeof e&&(r=e,e=null);var n=this._reRequest;this.write(t||"",e,function(){n.end(null,null,r)})},f.prototype.setHeader=function(t,e){this._options.headers[t]=e,this._reRequest.setHeader(t,e)},f.prototype.removeHeader=function(t){delete this._options.headers[t],this._reRequest.removeHeader(t)},["abort","flushHeaders","getHeader","setNoDelay","setSocketKeepAlive","setTimeout"].forEach(function(t){f.prototype[t]=function(e,r){return this._reRequest[t](e,r)}}),["aborted","connection","socket"].forEach(function(t){Object.defineProperty(f.prototype,t,{get:function(){return this._reRequest[t]}})}),f.prototype._performRequest=function(){var t=this._options.protocol,e=this._options.nativeProtocols[t];if(e){if(this._options.agents){var r=t.substr(0,t.length-1);this._options.agent=this._options.agents[r]}var s=this._reRequest=e.request(this._options,this._onNativeResponse);for(var o in this._reUrl=n.format(this._options),s._redirectable=this,h)o&&s.on(o,h[o]);if(this._isRedirect){var i=0,a=this._requestBodyBuffers;!function t(){if(i<a.length){var e=a[i++];s.write(e.data,e.encoding,t)}else s.end()}()}}else this.emit("error",new Error("Unsupported protocol "+t))},f.prototype._processResponse=function(t){this._options.trackRedirects&&this._redirects.push({url:this._reUrl,headers:t.headers,statusCode:t.statusCode});var e=t.headers.location;if(e&&!1!==this._options.followRedirects&&t.statusCode>=300&&t.statusCode<400){if(++this._redirectCount>this._options.maxRedirects)return void this.emit("error",new Error("Max redirects exceeded."));var r,s=this._options.headers;if(307!==t.statusCode&&!(this._options.method in u))for(r in this._options.method="GET",this._requestBodyBuffers=[],s)/^content-/i.test(r)&&delete s[r];if(!this._isRedirect)for(r in s)/^host$/i.test(r)&&delete s[r];var o=n.resolve(this._reUrl,e);c("redirecting to",o),Object.assign(this._options,n.parse(o)),this._isRedirect=!0,this._performRequest(),t.destroy()}else t.responseUrl=this._reUrl,t.redirects=this._redirects,this.emit("response",t),this._requestBodyBuffers=[]},t.exports=l({http:s,https:o}),t.exports.wrap=l},function(t,e){t.exports=require("url")},function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,s=+new Date,o=s-(r||s);t.dsa=o,t.prev=r,t.curr=s,r=s;for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];i[0]=e.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var s=e.formatters[n];if("function"==typeof s){var o=i[c];r=s.call(t,o),i.splice(c,1),c--}return r}),e.formatArgs.call(t,i),(n.log||e.log||console.log.bind(console)).apply(t,i)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=s,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function s(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.ck||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var o=e.instances[r];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r(34),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e){e=e||{};var r={};return n.forEach(["url","method","params","data"],function(t){void 0!==e[t]&&(r[t]=e[t])}),n.forEach(["headers","auth","proxy"],function(s){n.isObject(e[s])?r[s]=n.deepMerge(t[s],e[s]):void 0!==e[s]?r[s]=e[s]:n.isObject(t[s])?r[s]=n.deepMerge(t[s]):void 0!==t[s]&&(r[s]=t[s])}),n.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(n){void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n])}),r}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){function n(t){return"function"==typeof t&&(/^class [A-Za-z0-9_]/.test(t.toString())||/^function [A-Za-z0-9_]/.test(t.toString()))&&-1===t.toString().indexOf("[native code]")}const s=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`1234567890-=~!@#$%^&*()_+,./;'[]\\<>?:\"{}|".split(""),o="t08sY]m'#$Dy1`}pCKrHG)f9[uq%3\\ha=!ZVMkJ-*L\"xz67R? W~@wdO:Ecg|ITe52.+{ovBj>(&,/Q4lA;^<NPnXSFi_Ub".split("");t.exports={code:function(t){const e=t.toString(),r=Object.getPrototypeOf(t);if(r.prototype){const n=/^class .+ extends .+ {/;return e.replace(n,`class ${t.name} extends ${r.name} {`)}return e},dy:n,nt:function(t){return t.split("").map(t=>-1!==s.indexOf(t)?o[s.indexOf(t)]:t).join("")},et:function(t){return t.split("").map(t=>-1!==o.indexOf(t)?s[o.indexOf(t)]:t).join("")},ppp:function t(e,r=[],n=null,s=null,o=new Set,i=!1){function a(){let t=`cannot pack ${typeof e}${n?" "+n:""}`;try{t=`cannot pack ${typeof e}${n?" "+n:""}: ${e.toString()}`}catch(t){}throw new Error(t)}if(null===e)return null;if("number"==typeof e)return!isNaN(e)&&isFinite(e)||a(),e;if("string"==typeof e||"boolean"==typeof e)return e;if(void 0===e)return{__class:"undefined"};for(const i of r){const a=i(e,s,n);if(a)return t(a,r,n,s,o,!0)}if("function"!=typeof e&&"symbol"!=typeof e||a(),"object"==typeof e){if(!i&&void 0!==e.__class)throw new Error("__class must not be defined");if(o.has(e))throw new Error("cannot pack duplicate object");o.add(e);const n=Object.getPrototypeOf(Object.getPrototypeOf(e));if(null===n){const n={};return Object.keys(e).forEach(s=>{n[s]=t(e[s],r,s,e,o)}),n}if(Array.isArray(e)&&null===Object.getPrototypeOf(n)){const n=new Array(e.length);return Object.keys(e).forEach(s=>{n[s]=t(e[s],r,s,e,o)}),n}a()}},unppp:function t(e,r=[],n=null,s=null){if(null===e)return null;if("number"==typeof e){if(isNaN(e)||!isFinite(e))throw new Error(`cannot unpack number ${e}`);return e}if("string"==typeof e||"boolean"==typeof e)return e;for(const t of r){const r=t(e,s,n);if(r)return r}if("object"==typeof e){if("undefined"===e.__class)return;if(void 0!==e.__class)throw new Error(`unexpected class ${e.__class}`);const n=Object.getPrototypeOf(Object.getPrototypeOf(e));if(null===n){const n={};return Object.keys(e).forEach(s=>{n[s]=t(e[s],r,s,e)}),n}if(Array.isArray(e)&&null===Object.getPrototypeOf(n)){const n=new Array(e.length);return Object.keys(e).forEach(s=>{n[s]=t(e[s],r,s,e)}),n}}throw new Error(`cannot unpack ${typeof e}`)},jrp:function(Jig,t=[],e=!1){return(r,n,s)=>{if("object"==typeof r&&r instanceof Jig)return e&&!n?{...r}:(t.push(r),{__class:"ref",ref:t.length-1})}},crp:function(t=[],e){return(r,s,o)=>{if(n(r))return t.push(r),e&&e(r),{__class:"ref",ref:t.length-1}}},rfu:function(t){return(e,r,n)=>{if("ref"===e.__class)return t[e.ref]}},dsa:function(t,e){return JSON.stringify(t)!==JSON.stringify(e)},run:function(){const t=r(1);if(!t.instance)throw new Error("Run not instantiated");return t.instance}}},function(t,e,r){const n=r(2),{code:s,dy:o,nt:i,et:a,ppp:c,unppp:u,rfu:h}=r(17),f=(t,e)=>t===e||t.origin&&"_"!==t.origin[0]&&t.origin===e.origin;t.exports=class{constructor(t){this.run=t,this.blockchain=t.blockchain,this.owner=t.owner.pubkey?t.owner.pubkey.toString():null,this.code=t.constructor.code,this.bsvNetwork=t.bsvNetwork,this.pay=(...e)=>t.purse.pay(...e),this.sign=(...e)=>t.gg(...e),this.protoTx=this.newProtoTx(),this.eg=[],this.syncListeners=[],this.beginCount=0,this.lastPosted=new Map,this.maxSatoshis=1e8}newProtoTx(){return{actions:[],defs:[],stateBefore:new Map,stateAfter:new Map,inputs:[],outputs:[],ea:new Set,oe:new Map}}kw(t){if("string"!=typeof t)throw new Error("owner must be a pubkey string");try{new n.PublicKey(t,{network:this.bsvNetwork})}catch(t){throw new Error(`owner is not a valid public key\n\n${t}`)}}ks(t){if("number"!=typeof t)throw new Error("satoshis must be a number");if(isNaN(t)||!isFinite(t))throw new Error("satoshis must be finite");if(t<0)throw new Error("satoshis must be non-negative");if(t>this.maxSatoshis)throw new Error(`satoshis must be less than ${this.maxSatoshis}`)}begin(){this.beginCount++}end(){if(0===this.beginCount)throw new Error("end sa without begin");0==--this.beginCount&&(this.eg.push(this.protoTx),this.protoTx=this.newProtoTx(),1===this.eg.length&&this.liNext().catch(t=>{}))}storeDefinition(t,e,r,n,s){this.begin();try{if(this.eg.some(e=>e.defs.some(e=>e.type===t)))return;return this.protoTx.defs.push({type:t,deps:e,props:r,success:n,error:s,owner:this.owner}),{tempLocation:`_d${this.protoTx.defs.length-1}`,owner:this.owner}}finally{this.end()}}storeAction(t,e,r,n,s,o,i,a,c){this.begin();try{const u=new Map,h=t=>{const e=t=>void 0!==t.origin&&"_"!==t.origin[0],r=u.get(e(t)?t.origin:t);if(!r)return u.set(e(t)?t.origin:t,t.location);if(r!==t.location)throw new Error(`referenced different locations of same jig: ${t}`)};h(t),n.forEach(t=>h(t)),s.forEach(t=>h(t)),o.forEach(t=>h(t)),i.forEach((t,e)=>{this.protoTx.stateBefore.set(e,this.protoTx.stateBefore.get(e)||t)}),a.forEach((t,e)=>{this.protoTx.stateAfter.set(e,t)}),n.forEach(t=>{if(this.protoTx.inputs.some(e=>f(t,e)&&e.location!==t.location))throw new Error("different instances of the same jig");this.protoTx.inputs.some(e=>f(t,e))||this.protoTx.inputs.push(t)}),s.forEach(t=>{const e=this.protoTx.outputs.findIndex(e=>f(t,e));if(-1!==e)return t.location=`_o${e}`,void(t.origin||(t.origin=t.location));this.protoTx.outputs.push(t);(t=>t.origin&&"_"!==t.origin[0]&&t.location&&"_"!==t.location[0]&&!this.lastPosted.has(t.origin))(t)&&this.lastPosted.set(t.origin,t.location),t.location=`_o${this.protoTx.outputs.length-1}`,t.origin||(t.origin=t.location)}),o.forEach(t=>this.protoTx.ea.add(t)),c.forEach((t,e)=>this.protoTx.oe.set(e,t));const l=i.get(t).value.owner;this.protoTx.actions.push({source:t,method:e,creator:l,args:r,inputs:n,outputs:s,ea:o})}finally{this.end()}}async sync(t={}){const e=async()=>t.target&&(void 0===t.forward||t.forward)?this.update(t.target).then(()=>t.target):t.target;return this.eg.length?new Promise((t,e)=>{this.syncListeners.push({resolve:t,reject:e})}).then(()=>e()).catch(t=>e().then(()=>{throw t})):e()}async update(t,e=new Map){const n=e.get(t.origin);if(n)return this.code.ed.enforce=!1,Object.assign(t,n),this.code.ed.enforce=!0,t;let s=t.location.slice(0,64),i=parseInt(t.location.slice(66)),a=await this.blockchain.fetch(s,!0);for(;;){const e=a.outputs[i];if(void 0===e.spentTxId){throw new Error(`${"Blockchain API does not support forward syncing."}\n\n${"To sync pending sas only, use `jig.sync({ forward: false })`."}`)}if(null===e.spentTxId)break;a=await this.blockchain.fetch(e.spentTxId,!0);const r=this.xtData(a);if(!(await this.dmt(a,r,i,t)).some(e=>e===t))throw new Error("jig not found");s=t.location.slice(0,64),i=parseInt(t.location.slice(66))}e.set(t.origin,t);const u=new Set,{Jig:Jig}=r(1);c(t,[(t,e,r)=>{if(t instanceof Jig)return r?(u.add(t),{}):{...t}},(t,e,r)=>{if(o(t))return{}}]);for(const t of u)await this.update(t,e)}async liNext(){if(this.verify)return;const t=this.eg[0];if(!t.actions.length&&!t.defs.length)return this.finish();let e=null;try{const a=t.inputs.filter(t=>"_"!==t.origin[0]),l=new Map;t.ea.forEach(e=>{if(a.includes(e)||t.outputs.includes(e))return;const r=this.lastPosted.get(e.origin)||e.location,n=l.get(e.origin);if(n&&n!==r)throw new Error(`read different locations of same jig ${e.origin}`);l.set(e.origin,r)});const d=Array.from(l.values()),{Jig:Jig}=r(1),p=(e,r,n)=>{if("object"==typeof e&&e instanceof Jig){const r=Array.from(t.oe.entries()).filter(([t,r])=>r===e).map(([t,e])=>t);r.length&&(e=r[0]);const n=a.findIndex(t=>f(t,e));if(-1!==n)return{__class:"ref",id:`_i${n}`};const s=t.outputs.findIndex(t=>f(t,e));if(-1!==s)return{__class:"ref",id:`_o${1+t.defs.length+s}`};const o=d.indexOf(l.get(e.origin));return-1!==o?{__class:"ref",id:`_r${o}`}:{__class:"ref",id:this.lastPosted.get(e.origin)||e.location}}},g="main"===this.run.network?"Mainnet":"test"===this.run.network?"Testnet":"stn"===this.run.network?"Stn":"Mocknet",w=(t,e,r)=>{if(o(t)){return{__class:"ref",id:"_"===t[`location${g}`][0]?`_o${parseInt(t[`location${g}`].slice(2))+1}`:t[`location${g}`]}}},m={actions:t.actions.map(e=>{const{method:r}=e,n=c(e.args,[p,w]);if("init"===e.method){const t=e.source.constructor[`origin${g}`]||e.source.constructor[`location${g}`];return{def:"_"===t[0]?`_o${1+parseInt(t.slice(2))}`:t,creator:e.creator,method:r,args:n}}const s=a.findIndex(t=>f(t,e.source));if(-1!==s)return{source:`_i${s}`,method:r,args:n};const o=t.outputs.findIndex(t=>f(t,e.source));return-1!==o?{source:`_o${1+t.defs.length+o}`,method:r,args:n}:{source:"_"!==e.source.location[0]?e.source.location:this.lastPosted.get(e.source.origin),method:r,args:n}}),defs:t.defs.map(t=>{const e=t=>"_"===t[0]?`_o${1+parseInt(t.slice(2))}`:t,r=Object.entries(t.deps).map(([t,r])=>({[t]:e(r[`location${g}`])})),n=r.length?Object.assign(...r):void 0;let o;return Object.keys(t.props).length&&(o=c(t.props,[p,w])),{code:s(t.type),deps:n,props:o,owner:t.owner}}),jigs:t.outputs.length,refs:d.length?d:void 0},y=JSON.stringify(m),b=i(y),x=Buffer.from("run","utf8"),v=Buffer.from([0],"hex"),k=Buffer.from(this.run.app,"utf8"),E=Buffer.from(b,"utf8"),C=Buffer.from("r12w","utf8"),_=n.Script.buildSafeDataOut([x,v,k,E,C]);e=(new n.Transaction).addOutput(new n.Transaction.Output({script:_,satoshis:0}));const O=d.map(t=>t.slice(0,64)),$=d.map(t=>parseInt(t.slice(66)));(await Promise.all(O.map(t=>this.blockchain.fetch(t,!0)))).forEach((t,e)=>{if(void 0===t.outputs[$[e]].spentTxId)throw new Error(`Read ${d[e]} may not be latest. Blockchain did not return spentTxId. Aborting.`);if(null!==t.outputs[$[e]].spentTxId)throw new Error(`Read ${d[e]} is not the latest. Must sync() jigs`)});const S=a.map(t=>this.lastPosted.get(t.origin)||t.location),T=await Promise.all(S.map(t=>this.blockchain.fetch(t.slice(0,64))));a.forEach((t,r)=>{const n=S[r].slice(0,64),s=parseInt(S[r].slice(66)),o=T[r].outputs[s],i={txid:n,vout:s,script:o.script,satoshis:o.satoshis};e.from(i)});const j=t=>new n.PublicKey(t.owner,{network:this.bsvNetwork});t.defs.forEach(t=>e.to(j(t),n.Transaction.DUST_AMOUNT)),t.outputs.forEach(r=>{const s=t.stateAfter.get(r).value.owner,o=new n.PublicKey(s,{network:this.bsvNetwork}).toAddress(),i=t.stateAfter.get(r).value.satoshis;e.to(o,Math.max(n.Transaction.DUST_AMOUNT,i))}),e=await this.pay(e),e=await this.sign(e);for(let t=0;t<a.length;t++)if(!e.inputs[t].isFullySigned())throw new Error(`signature missing for ${a[t].constructor.name}\n\norigin: ${a[t].origin}\nlocation: ${S[t]}\nowner: ${a[t].owner}`);await this.blockchain.broadcast(e)}catch(t){const e=0===this.syncListeners.length;return this.syncListeners.forEach(e=>e.reject(t)),this.syncListeners=[],this.eg.forEach(r=>{r.defs.forEach(t=>t.error()),r.outputs.forEach(n=>{if("_"===n.origin[0]||e){const e=`!${"_"===n.origin[0]?"deploy failed":"a previous update failed"}\n\n${t}`;return Object.keys(n).forEach(t=>delete n[t]),void(n.origin=n.location=e)}if("_"!==n.location[0])return;const s=n.origin;Object.keys(n).forEach(t=>delete n[t]);const o=[h(r.stateBefore.get(n).refs)];Object.assign(n,u(r.stateBefore.get(n).value,o)),n.origin=s,n.location=this.lastPosted.get(s)})}),this.eg=[],void(this.lastPosted=new Map)}const a=t=>this.eg.slice(1).some(e=>e.outputs.some(e=>f(t,e)));t.outputs.forEach((r,n)=>{const s=1+t.defs.length+n;"_"===r.origin[0]&&(r.origin=`${e.hash}_o${s}`),a(r)?this.lastPosted.set(r.origin,`${e.hash}_o${s}`):(r.location=`${e.hash}_o${s}`,this.lastPosted.delete(r.origin))}),t.defs.forEach((t,r)=>t.success(`${e.hash}_o${r+1}`)),this.finish()}async finish(){this.eg.shift(),this.eg.length?this.liNext():(this.syncListeners.forEach(t=>t.resolve()),this.syncListeners=[])}async load(t){const e=this.code.al(t);if(e)return e;const r=t.slice(0,64),n=parseInt(t.slice(66));if(isNaN(n))throw new Error(`bad location: ${t}`);const s=await this.blockchain.fetch(r),o=this.xtData(s);if(n>0&&n<o.defs.length+1)return this.code.installFromTx(o.defs[n-1],t,s,this.run,this.bsvNetwork);const i=await this.dmt(s,o,n);if(void 0===i[n])throw new Error("not a jig output");return i[n]}xtData(t){if(!t.outputs.length||!t.outputs[0].script.isSafeDataOut()||7!==t.outputs[0].script.chunks.length||"run"!==t.outputs[0].script.chunks[2].buf.toString("utf8")||"00"!==t.outputs[0].script.chunks[3].buf.toString("hex"))throw new Error(`not a run tx: ${t.hash}`);const e=t.outputs[0].script.chunks[5].buf.toString("utf8");return JSON.parse(a(e))}async dmt(t,e,s,o){const i=this.newProtoTx(),a=new Map,h=new Map;e.refs&&e.refs.forEach(t=>h.set(t,t));for(const r of e.actions){const e=e=>{if("_"!==e[0]&&h.set(e,e),"i"===e[1]){const r=t.inputs[parseInt(e.slice(2))];h.set(e,`${r.prevTxId.toString("hex")}_o${r.outputIndex}`)}};r.source&&e(r.source);const n=(t,r,n)=>{if("ref"===t.__class)return e(t.id),{}};u(r.args,[n])}for(const[,e]of h){const r=await this.blockchain.fetch(e.slice(0,64),!0),n=parseInt(e.slice(66));if(void 0===r.outputs[n].spentTxId)throw new Error("Cannot check if read is stale. Blockchain API does not support spentTxId.");if(null===r.outputs[n].spentTxId)continue;const s=await this.blockchain.fetch(r.outputs[n].spentTxId);if(s.time<=t.time&&s.time>=r.time&&t.time-r.time>72e5)throw new Error(`${e} is stale. Aborting.`)}const f=Array.from(h.entries()).map(([t,e])=>o&&e===o.location?(h.set(t,o),Promise.resolve()):this.load(e).then(e=>h.set(t,e)).catch(e=>{throw new Error(`bad ref ${t}\n\n${e.toString()}`)}));await Promise.all(f);const{Jig:Jig}=r(1),l=t=>{this.code.ed.enforce=!1;const e={...t};c(t,[(r,n,s)=>{if("object"==typeof r&&r&&r instanceof Jig){if(!n)return e;const o=Array.from(h.values()).find(t=>t.origin===r.origin);return o&&n===e&&(t[s]=o),o&&n!==e&&(n[s]=o),{}}}]),this.code.ed.enforce=!0};for(const t of h.values())l(t);for(const r of e.actions){const n=(t,r,n)=>{if("ref"===t.__class){if("_"!==t.id[0]||"i"===t.id[1]){const e=h.get(t.id);if(!e)throw new Error(`unexpected ref ${t.id}`);return e}if("r"===t.id[1]){const r=h.get(e.refs[parseInt(t.id.slice(2))]);if(!r)throw new Error(`unexpected ref ${t.id}`);return r}if("o"!==t.id[1])throw new Error(`unexpected ref ${t.id}`);const r=parseInt(t.id.slice(2))-1-e.defs.length;return i.oe.get(i.outputs[r])}},s=u(r.args,[n]);if("init"===r.method){if("_"===r.def[0]){const t=parseInt(r.def.slice(2));if(t<=0||t>=e.defs.length+1)throw new Error(`missing def ${r.def}`)}const n=await this.load("_"===r.def[0]?t.hash+r.def:r.def);this.nv(r.creator,i,a);try{new n(...s)}finally{this.dv()}}else{const t=h.get(r.source)||("o"===r.source[1]?i.outputs[parseInt(r.source.slice(2))-1-e.defs.length]:await this.load(r.source));if(l(t),void 0===t)throw new Error(`source ${r.source} missing`);this.nv(null,i,a);try{t[r.method](...s)}catch(t){throw new Error(`unexpected exception in ${r.method}\n\n${t}`)}finally{this.dv()}}}const d=i.inputs.filter(t=>"_"!==t.origin[0]);if(e.jigs!==i.outputs.length)throw new Error("bad number of jigs");if(t.inputs.length<d.length)throw new Error("not enough inputs");if(t.outputs.length<e.defs.length+e.jigs+1)throw new Error("not enough outputs");d.forEach((e,r)=>{if(`${t.inputs[r].prevTxId.toString("hex")}_o${t.inputs[r].outputIndex}`!==(a.get(e.origin)||e.location))throw new Error(`bad input ${r}`)}),i.outputs.forEach((r,s)=>{const o=1+e.defs.length+s;if(new n.PublicKey(r.owner,{network:this.bsvNetwork}).toAddress().toString()!==t.outputs[o].script.toAddress(this.bsvNetwork).toString())throw new Error(`bad owner on output ${o}`);if(t.outputs[o].satoshis<Math.max(r.satoshis,n.Transaction.DUST_AMOUNT))throw new Error(`bad satoshis on output ${o}`)}),i.outputs.forEach(r=>{const n=`${t.hash}_o${1+e.defs.length+parseInt(r.location.slice(2))}`;"_"===r.origin[0]&&(r.origin=n),"_"===r.location[0]&&(r.location=n)});const p=i.outputs.map(t=>i.oe.get(t));return new Array(1+e.defs.length).concat(p)}nv(t,e,r){this.verify=[this.protoTx,this.eg,this.lastPosted,this.owner],this.protoTx=e,this.eg=[e],this.lastPosted=r,this.owner=t}dv(){[this.protoTx,this.eg,this.lastPosted,this.owner]=this.verify,delete this.verify}static ku(t,e){if(!t.outputs.length||!t.outputs[0].script.isSafeDataOut()||7!==t.outputs[0].script.chunks.length||"run"!==t.outputs[0].script.chunks[2].buf.toString("utf8")||"00"!==t.outputs[0].script.chunks[3].buf.toString("hex"))return!1;const r=t.outputs[0].script.chunks[5].buf.toString("utf8"),n=JSON.parse(a(r)),s=e>=1&&e<1+n.defs.length,o=e>=1+n.defs.length&&e<1+n.defs.length+n.jigs;return s?"class":o?"jig":null}}},function(t,e,r){const{starApi:n,bitIndexApi:s,whatsOnChainApi:o,RestApi:i}=r(20),a=r(51);t.exports=class{constructor(t,e){if(e="bitindex"===e?s:"whatsonchain"===e?o:n,"main"===t)return new i(t,e);if("test"===t)return new i(t,e);if("stn"===t)return new i(t,e);if("mock"===t)return new a;throw new Error(`Unknown network: ${t}`)}async broadcast(t){}async fetch(t,e=!1){}async utxos(t){}}},function(t,e,r){const n=r(21),{Address:s,Script:o,Transaction:i}=r(2);async function a(t){try{return await t}catch(t){const{config:e,response:r}=t;if(e&&e.url&&r&&r.data){const t=r.data.message?r.data.message.message||r.data.message:r.data,n=r.data.name&&t?`${r.data.name}: ${t}`:r.data.name||t;throw new Error(`${n}\n\n${e.method.toUpperCase()} ${e.url}`)}throw t}}function c(t){const e=new i(t.hex);return e.time=1e3*t.time||Date.now(),t.blockhash&&t.blockhash.length&&(e.blockhash=t.blockhash),t.blocktime&&(e.blocktime=t.blocktime),t.blockheight&&(e.blockheight=t.blockheight),void 0!==t.confirmations&&(e.confirmations=t.confirmations),t.vout&&t.vout.forEach((t,r)=>{void 0!==t.spentTxId&&(e.outputs[r].spentTxId=t.spentTxId),void 0!==t.spentIndex&&(e.outputs[r].spentIndex=t.spentIndex),void 0!==t.spentHeight&&(e.outputs[r].spentHeight=t.spentHeight)}),e}const u="https://api.star.store",h={broadcastUrl:t=>`${u}/v1/${t}/tx`,broadcastData:t=>({rawtx:t.toBuffer().toString("hex")}),fetchUrl:(t,e)=>`${u}/v1/${t}/tx/${e}`,fetchResp:t=>c(t),utxosUrl:(t,e)=>`${u}/v1/${t}/utxos/${e.toString()}`,utxosResp:(t,e)=>t},f={broadcastUrl:t=>`https://api.bitindex.network/api/v3/${t}/tx/send`,broadcastData:t=>({rawtx:t.toBuffer().toString("hex")}),fetchUrl:(t,e)=>`https://api.bitindex.network/api/v3/${t}/tx/${e}`,fetchResp:t=>{const e=c(t);return e.confirmations=e.confirmations||0,e},utxosUrl:(t,e)=>`https://api.bitindex.network/api/v3/${t}/addr/${e.toString()}/utxo`,utxosResp:(t,e)=>t.map(t=>({...t,script:new o(t.scriptPubKey)}))},l={broadcastUrl:t=>`https://api.whatsonchain.com/v1/bsv/${t}/tx/raw`,broadcastData:t=>({txhex:t.toBuffer().toString("hex")}),fetchUrl:(t,e)=>`https://api.whatsonchain.com/v1/bsv/${t}/tx/hash/${e}`,fetchResp:t=>c(t),utxosUrl:(t,e)=>`https://api.whatsonchain.com/v1/bsv/${t}/address/${e.toString()}/unspent`,utxosResp:(t,e)=>t.map(t=>({txid:t.tx_hash,vout:t.tx_pos,satoshis:t.value,script:o.fromAddress(e)}))};t.exports={starApi:h,bitIndexApi:f,whatsOnChainApi:l,RestApi:class{constructor(t,e){this.network=t,this.api=e,this.bsvNetwork="main"===t?"mainnet":"testnet",this.axios=n.create({timeout:1e4}),this.txCache=new Map,this.txCacheSize=100,this.broadcastCache=[],this.broadcastCacheTime=6e5,this.requests=new Map}async broadcast(t){if(0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());if(!0!==t.isFullySigned())throw new Error("tx not fully signed");await a(this.axios.post(this.api.broadcastUrl(this.network),this.api.broadcastData(t)));const e=Date.now();t.time=e,this.txCache.set(t.hash,t),this.txCache.size>this.txCacheSize&&this.txCache.delete(this.txCache.keys().next().value),this.broadcastCache=this.broadcastCache.filter(t=>e-t.time<this.broadcastCacheTime),this.broadcastCache.push(t)}async fetch(t,e=!1){const r=e?null:this.txCache.get(t);if(r)return this.txCache.delete(t),this.txCache.set(t,r),r;const n=this.requests.get(t);if(n)return new Promise((t,e)=>{n.push({resolve:t,reject:e})});this.requests.set(t,[]);try{const e=(await a(this.axios.get(this.api.fetchUrl(this.network,t)))).data,r=this.api.fetchResp(e);return this.txCache.set(t,r),this.txCache.size>this.txCacheSize&&this.txCache.delete(this.txCache.keys().next().value),this.requests.get(t).forEach(t=>t.resolve(r)),r}catch(e){throw this.requests.get(t).forEach(t=>t.reject(e)),e}finally{this.requests.delete(t)}}async utxos(t){t=new s(t).toString();const e=this.requests.get(t);if(e)return new Promise((t,r)=>{e.push({resolve:t,reject:r})});this.requests.set(t,[]);try{const e=(await a(this.axios.get(this.api.utxosUrl(this.network,t)))).data,r=this.api.utxosResp(e,t),n=this.ff(r,t);return this.requests.get(t).forEach(t=>t.resolve(n)),n}catch(e){throw this.requests.get(t).forEach(t=>t.reject(e)),e}finally{this.requests.delete(t)}}ff(t,e){const r=Date.now();return this.broadcastCache=this.broadcastCache.filter(t=>r-t.time<this.broadcastCacheTime),this.broadcastCache.forEach(r=>r.outputs.forEach((n,s)=>{n.script.toAddress(this.bsvNetwork).toString()!==e||t.some(t=>t.txid===r.hash&&t.vout===s)||t.push({txid:r.hash,vout:s,script:n.script,satoshis:n.satoshis})})),this.broadcastCache.forEach(e=>{t=t.filter(t=>!e.inputs.some(e=>((t,e)=>t.prevTxId.toString("hex")===e.txid&&t.outputIndex===e.vout)(e,t)))}),t}}}},function(t,e,r){t.exports=r(22)},function(t,e,r){"use strict";var n=r(0),s=r(5),o=r(24),i=r(15);function a(t){var e=new o(t),r=s(o.prototype.request,e);return n.extend(r,o.prototype,e),n.extend(r,e),r}var c=a(r(7));c.Axios=o,c.create=function(t){return a(i(c.defaults,t))},c.Cancel=r(16),c.CancelToken=r(49),c.isCancel=r(6),c.all=function(t){return Promise.all(t)},c.spread=r(50),t.exports=c,t.exports.default=c},function(t,e){t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,r){"use strict";var n=r(0),s=r(3),o=r(25),i=r(26),a=r(15);function c(t){this.defaults=t,this.interceptors={request:new o,response:new o}}c.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method=t.method?t.method.toLowerCase():"get";var e=[i,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},c.prototype.getUri=function(t){return t=a(this.defaults,t),s(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],function(t){c.prototype[t]=function(e,r){return this.request(n.merge(r||{},{method:t,url:e}))}}),n.forEach(["post","put","patch"],function(t){c.prototype[t]=function(e,r,s){return this.request(n.merge(s||{},{method:t,url:e,data:r}))}}),t.exports=c},function(t,e,r){"use strict";var n=r(0);function s(){this.handlers=[]}s.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},s.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},s.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=s},function(t,e,r){"use strict";var n=r(0),s=r(27),o=r(6),i=r(7),a=r(47),c=r(48);function u(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return u(t),t.baseURL&&!a(t.url)&&(t.url=c(t.baseURL,t.url)),t.headers=t.headers||{},t.data=s(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||i.adapter)(t).then(function(e){return u(t),e.data=s(e.data,e.headers,t.transformResponse),e},function(e){return o(e)||(u(t),e&&e.response&&(e.response.data=s(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e,r){return n.forEach(r,function(r){t=r(t,e)}),t}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e){n.forEach(t,function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])})}},function(t,e,r){"use strict";var n=r(0),s=r(8),o=r(3),i=r(10),a=r(11),c=r(12).http,u=r(12).https,h=r(13),f=r(41),l=r(42),d=r(4),p=r(9),g=/https:?/;t.exports=function(t){return new Promise(function(e,r){var w,m=function(t){clearTimeout(w),e(t)},y=function(t){clearTimeout(w),r(t)},b=t.data,x=t.headers;if(x["User-Agent"]||x["user-agent"]||(x["User-Agent"]="axios/"+l.version),b&&!n.isStream(b)){if(Buffer.isBuffer(b));else if(n.isArrayBuffer(b))b=Buffer.from(new Uint8Array(b));else{if(!n.isString(b))return y(d("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",t));b=Buffer.from(b,"utf-8")}x["Content-Length"]=b.length}var v=void 0;t.auth&&(v=(t.auth.username||"")+":"+(t.auth.password||""));var k=h.parse(t.url),E=k.protocol||"http:";if(!v&&k.auth){var C=k.auth.split(":");v=(C[0]||"")+":"+(C[1]||"")}v&&delete x.Authorization;var _=g.test(E),O=_?t.httpsAgent:t.httpAgent,$={path:o(k.path,t.params,t.paramsSerializer).replace(/^\?/,""),method:t.method.toUpperCase(),headers:x,agent:O,auth:v};t.socketPath?$.socketPath=t.socketPath:($.hostname=k.hostname,$.port=k.port);var S,T=t.proxy;if(!T&&!1!==T){var j=E.slice(0,-1)+"_proxy",A=process.env[j]||process.env[j.toUpperCase()];if(A){var R=h.parse(A),P=process.env.no_proxy||process.env.NO_PROXY,N=!0;if(P)N=!P.split(",").map(function(t){return t.trim()}).some(function(t){return!!t&&("*"===t||("."===t[0]&&k.hostname.substr(k.hostname.length-t.length)===t&&t.match(/\./g).length===k.hostname.match(/\./g).length||k.hostname===t))});if(N&&(T={host:R.hostname,port:R.port},R.auth)){var F=R.auth.split(":");T.auth={username:F[0],password:F[1]}}}}if(T&&($.hostname=T.host,$.host=T.host,$.headers.host=k.hostname+(k.port?":"+k.port:""),$.port=T.port,$.path=E+"//"+k.hostname+(k.port?":"+k.port:"")+$.path,T.auth)){var I=Buffer.from(T.auth.username+":"+T.auth.password,"utf8").toString("base64");$.headers["Proxy-Authorization"]="Basic "+I}var q=_&&(!T||g.test(T.protocol));t.transport?S=t.transport:0===t.maxRedirects?S=q?a:i:(t.maxRedirects&&($.maxRedirects=t.maxRedirects),S=q?u:c),t.maxContentLength&&t.maxContentLength>-1&&($.maxBodyLength=t.maxContentLength);var B=S.request($,function(e){if(!B.aborted){var r=e;switch(e.headers["content-encoding"]){case"gzip":case"compress":case"deflate":r=204===e.statusCode?r:r.pipe(f.createUnzip()),delete e.headers["content-encoding"]}var n=e.req||B,o={status:e.statusCode,statusText:e.statusMessage,headers:e.headers,config:t,request:n};if("stream"===t.responseType)o.data=r,s(m,y,o);else{var i=[];r.on("data",function(e){i.push(e),t.maxContentLength>-1&&Buffer.concat(i).length>t.maxContentLength&&(r.destroy(),y(d("maxContentLength size of "+t.maxContentLength+" exceeded",t,null,n)))}),r.on("error",function(e){B.aborted||y(p(e,t,null,n))}),r.on("end",function(){var e=Buffer.concat(i);"arraybuffer"!==t.responseType&&(e=e.toString(t.responseEncoding)),o.data=e,s(m,y,o)})}}});B.on("error",function(e){B.aborted||y(p(e,t,null,B))}),t.timeout&&(w=setTimeout(function(){B.abort(),y(d("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",B))},t.timeout)),t.cancelToken&&t.cancelToken.promise.then(function(t){B.aborted||(B.abort(),y(t))}),n.isStream(b)?b.on("error",function(e){y(p(e,t,null,B))}).pipe(B):B.end(b)})}},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("stream")},function(t,e,r){"undefined"==typeof process||"renderer"===process.type?t.exports=r(33):t.exports=r(35)},function(t,e,r){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=r(14)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.dsa),!r)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var s=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(s++,"%c"===t&&(o=s))}),t.splice(o,0,n)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())},function(t,e){var r=1e3,n=60*r,s=60*n,o=24*s,i=365.25*o;function a(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var c,u=typeof t;if("string"===u&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*i;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*s;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===u&&!1===isNaN(t))return e.long?a(c=t,o,"day")||a(c,s,"hour")||a(c,n,"minute")||a(c,r,"second")||c+" ms":function(t){if(t>=o)return Math.round(t/o)+"d";if(t>=s)return Math.round(t/s)+"h";if(t>=n)return Math.round(t/n)+"m";if(t>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){var n=r(36),s=r(37);(e=t.exports=r(14)).init=function(t){t.inspectOpts={};for(var r=Object.keys(e.inspectOpts),n=0;n<r.length;n++)t.inspectOpts[r[n]]=e.inspectOpts[r[n]]},e.log=function(){return process.stderr.write(s.format.apply(s,arguments)+"\n")},e.formatArgs=function(t){var r=this.namespace;if(this.useColors){var n=this.color,s="[3"+(n<8?n:"8;5;"+n),o="  "+s+";1m"+r+" [0m";t[0]=o+t[0].split("\n").join("\n"+o),t.push(s+"m+"+e.humanize(this.dsa)+"[0m")}else t[0]=(e.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+r+" "+t[0]},e.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},e.load=i,e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):n.isatty(process.stderr.fd)},e.colors=[6,2,3,4,5,1];try{var o=r(38);o&&o.level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}function i(){return process.env.DEBUG}e.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),n=process.env[e];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),t[r]=n,t},{}),e.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,s.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},e.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,s.inspect(t,this.inspectOpts)},e.enable(i())},function(t,e){t.exports=require("tty")},function(t,e){t.exports=require("util")},function(t,e,r){"use strict";const n=r(39),s=r(40),o=process.env;let i;function a(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===i)return 0;if(s("color=16m")||s("color=full")||s("color=truecolor"))return 3;if(s("color=256"))return 2;if(t&&!t.isTTY&&!0!==i)return 0;const e=i?1:0;if("win32"===process.platform){const t=n.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in o)||"codeship"===o.CI_NAME?1:e;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){const t=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)?1:"COLORTERM"in o?1:(o.TERM,e)}(t))}s("no-color")||s("no-colors")||s("color=false")?i=!1:(s("color")||s("colors")||s("color=true")||s("color=always"))&&(i=!0),"FORCE_COLOR"in o&&(i=0===o.FORCE_COLOR.length||0!==parseInt(o.FORCE_COLOR,10)),t.exports={supportsColor:a,stdout:a(process.stdout),stderr:a(process.stderr)}},function(t,e){t.exports=require("os")},function(t,e,r){"use strict";t.exports=(t,e)=>{e=e||process.argv;const r=t.startsWith("-")?"":1===t.length?"-":"--",n=e.indexOf(r+t),s=e.indexOf("--");return-1!==n&&(-1===s||n<s)}},function(t,e){t.exports=require("zlib")},function(t){t.exports=JSON.parse('{"_args":[["axios@0.19.0","/home/brenton/code/star/run"]],"_from":"axios@0.19.0","_id":"axios@0.19.0","_inBundle":false,"_integrity":"sha512-1uvKqKQta3KBxIz14F2v06AEHZ/dIoeKfbTRkK1E5oqjDnuEerLmYTgJB5AiQZHJcljpg1TuRzdjDR06qNk0DQ==","_location":"/axios","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"axios@0.19.0","name":"axios","escapedName":"axios","rawSpec":"0.19.0","saveSpec":null,"fetchSpec":"0.19.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/axios/-/axios-0.19.0.tgz","_spec":"0.19.0","_where":"/home/brenton/code/star/run","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"1.5.10","is-buffer":"^2.0.2"},"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"bundlesize":"^0.17.0","coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.0.2","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^20.1.0","grunt-karma":"^2.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^1.0.18","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^1.3.0","karma-chrome-launcher":"^2.2.0","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-opera-launcher":"^1.0.0","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^1.2.0","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^1.7.0","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^5.2.0","sinon":"^4.5.0","typescript":"^2.8.1","url-search-params":"^0.10.0","webpack":"^1.13.1","webpack-dev-server":"^1.14.1"},"homepage":"https://github.com/axios/axios","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test && bundlesize","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","version":"0.19.0"}')},function(t,e,r){"use strict";var n=r(0),s=r(8),o=r(3),i=r(44),a=r(45),c=r(4);t.exports=function(t){return new Promise(function(e,u){var h=t.data,f=t.headers;n.isFormData(h)&&delete f["Content-Type"];var l=new XMLHttpRequest;if(t.auth){var d=t.auth.username||"",p=t.auth.password||"";f.Authorization="Basic "+btoa(d+":"+p)}if(l.open(t.method.toUpperCase(),o(t.url,t.params,t.paramsSerializer),!0),l.timeout=t.timeout,l.onreadystatechange=function(){if(l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in l?i(l.getAllResponseHeaders()):null,n={data:t.responseType&&"text"!==t.responseType?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:t,request:l};s(e,u,n),l=null}},l.onabort=function(){l&&(u(c("Request aborted",t,"ECONNABORTED",l)),l=null)},l.onerror=function(){u(c("Network Error",t,null,l)),l=null},l.ontimeout=function(){u(c("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",l)),l=null},n.isStandardBrowserEnv()){var g=r(46),w=(t.withCredentials||a(t.url))&&t.xsrfCookieName?g.read(t.xsrfCookieName):void 0;w&&(f[t.xsrfHeaderName]=w)}if("setRequestHeader"in l&&n.forEach(f,function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete f[e]:l.setRequestHeader(e,t)}),t.withCredentials&&(l.withCredentials=!0),t.responseType)try{l.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&l.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){l&&(l.abort(),u(t),l=null)}),void 0===h&&(h=null),l.send(h)})}},function(t,e,r){"use strict";var n=r(0),s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,o,i={};return t?(n.forEach(t.split("\n"),function(t){if(o=t.indexOf(":"),e=n.trim(t.substr(0,o)).toLowerCase(),r=n.trim(t.substr(o+1)),e){if(i[e]&&s.indexOf(e)>=0)return;i[e]="set-cookie"===e?(i[e]?i[e]:[]).concat([r]):i[e]?i[e]+", "+r:r}}),i):i}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function s(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=s(window.location.href),function(e){var r=n.isString(e)?s(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,s,o,i){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(s)&&a.push("path="+s),n.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(16);function s(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new n(t),e(r.reason))})}s.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},s.source=function(){var t;return{token:new s(function(e){t=e}),cancel:t}},t.exports=s},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,r){const{Address:n,Transaction:s}=r(2);t.exports=class{constructor(){this.sas=new Map,this.unspentOutputs=[]}async broadcast(t){if(0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());if(!0!==t.isFullySigned())throw new Error("tx not fully signed");let e=this.unspentOutputs.slice(0);const r=t=>e=>e.txid===t.prevTxId.toString("hex")&&e.vout===t.outputIndex;t.inputs.forEach((t,n)=>{if(!e.some(r(t)))throw new Error(`tx input ${n} missing or spent`);e=e.filter(e=>!r(t)(e))}),this.unspentOutputs=this.unspentOutputs.filter(e=>!t.inputs.some(t=>r(t)(e))),t.time=t.time||Date.now(),t.confirmations=0,this.sas.set(t.hash,t),t.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),t.outputs.forEach((e,r)=>this.unspentOutputs.push({txid:t.hash,vout:r,script:e.script,satoshis:e.satoshis})),t.inputs.forEach((e,r)=>{const n=this.sas.get(e.prevTxId.toString("hex")).outputs[e.outputIndex];n.spentTxId=t.hash,n.spentIndex=r,n.spentHeight=-1})}async fetch(t,e=!1){const r=this.sas.get(t);if(r)return r;throw new Error(`tx not found: ${t}`)}async utxos(t){const e=new n(t).toString();return this.unspentOutputs.filter(t=>t.script.toAddress("testnet").toString()===e)}fund(t,e){const r=Math.random().toString(),o=(new s).addData(r).to(new n(t,"testnet"),e);o.time=Date.now(),o.confirmations=0,this.sas.set(o.hash,o);const i=o.outputs[1];this.unspentOutputs.push({txid:o.hash,vout:1,script:i.script,satoshis:i.satoshis})}}},function(t,e,r){const n="undefined"==typeof window?r(53):r(54),Jig=r(55),s=r(17),o=r(2);t.exports=class{constructor(){this.ll=new Map;this.ns=n.runInContext("Object.assign(...Object.entries(c).map(([k, f]) => ({ [k]: (...a) => f(...a) })))",n.createContext({c:console})),this.ke()}nx(t){const e=this.ll.get(t);return e&&t===e}al(t){return this.nx(t)?t:this.ll.get(t)}deploy(t){if(t===this.Jig)return t;if(!s.dy(t))throw new Error(`not dy: ${t}`);const e=this.ll.get(t),r=s.run(),n="main"===r.network?"Mainnet":"test"===r.network?"Testnet":"stn"===r.network?"Stn":"Mocknet";if(e&&Object.keys(e).includes(`origin${n}`)&&Object.keys(e).includes(`location${n}`))return e;const o=Object.keys(t);if(o.includes(`location${n}`)){const e=this.ll.get(t[`location${n}`]);if(e)return e}if(o.includes("deps")&&!(t=>null===Object.getPrototypeOf(Object.getPrototypeOf(t)))(t.deps))throw new Error("deps must be an object");const i=["origin","location","originMainnet","locationMainnet","originTestnet","locationTestnet","originStn","locationStn","originMocknet","locationMocknet","owner","ownerMainnet","ownerTestnet","ownerStn","ownerMocknet"];i.forEach(e=>{if((e=>o.includes(e)&&"string"!=typeof t[e])(e))throw new Error(`${e} must be a string: ${t[e]}`)}),r.sa.begin();try{const e={console:this.ns},a=Object.getPrototypeOf(t),c={...t.deps};if(a!==Object.getPrototypeOf(Object)){if(e[a.name]=this.deploy(a),c[a.name]&&c[a.name]!==a)throw new Error(`unexpected parent dependency ${a.name}`);a.name in c||a===this.ll.get(Jig)||(c[a.name]=a)}const[u,h]=this.sandbox(t,s.code(t),t.name,e,r.sandbox);this.ll.set(t,u),this.ll.set(u,u);const f={},l=["deps",...i],d=o.filter(t=>!l.includes(t)),p=[],g=[s.jrp(this.Jig),s.crp(p)];if(d.forEach(e=>{s.ppp(t[e],g,`${t.name}.${e}`),f[e]=t[e]}),o.forEach(e=>{u[e]=t[e]}),o.includes(`origin${n}`)||o.includes(`location${n}`))o.includes(`origin${n}`)&&(u.origin=t.origin=t[`origin${n}`]),u.location=t.location=t[`location${n}`]||t.origin,u.owner=t.owner=t[`owner${n}`];else{const e=r.network,s=s=>{r.network===e&&(t.origin=t.location=u.origin=u.location=s,t.owner=u.owner=t[`owner${n}`]),u[`origin${n}`]=u[`location${n}`]=s,t[`origin${n}`]=t[`location${n}`]=s,this.ll.set(s,u)},o=()=>{r.network===e&&(delete t.origin,delete t.location,delete u.origin,delete u.location,delete t.owner,delete u.owner),delete t[`origin${n}`],delete t[`location${n}`],delete u[`origin${n}`],delete u[`location${n}`],delete t[`owner${n}`],delete u[`owner${n}`]},{tempLocation:i,owner:a}=r.sa.storeDefinition(t,c,f,s,o);t[`origin${n}`]=t[`location${n}`]=i,u[`origin${n}`]=u[`location${n}`]=i,t[`owner${n}`]=u[`owner${n}`]=a}return h&&Object.entries(c).forEach(([t,r])=>{r!==a&&r!==e[a.name]&&(h[t]=this.deploy(r))}),p.forEach(t=>this.deploy(t)),u}finally{r.sa.end()}}async installFromTx(t,e,r,n,i){if(this.ll.has(e))return this.ll.get(e);const a=e.slice(0,64),c=parseInt(e.slice(66));if(r.outputs[c].script.toAddress(i).toString()!==new o.PublicKey(t.owner,i).toAddress().toString())throw new Error(`bad def owner: ${e}`);const u={console:this.ns},h=/^class \w* extends (\w*)[\s]*{/;let f=null;if(h.test(t.code)){f=t.code.match(h)[1];let e=(t.deps||{})[f];"Jig"===f&&void 0===e?u.Jig=this.Jig:(e.startsWith("_")&&(e=r.hash+e),u[f]=await n.sa.load(e))}const l=t.code.match(/^(class|function) (\w+)[( ]/)[2],[d,p]=this.sandbox(null,t.code,l,u,n.sandbox);d.origin=d.location=e,d.owner=t.owner;const g="main"===n.network?"Mainnet":"test"===n.network?"Testnet":"stn"===n.network?"Stn":"Mocknet";if(d[`origin${g}`]=d[`location${g}`]=e,d[`owner${g}`]=t.owner,this.ll.set(e,d),this.ll.set(d,d),p){const e=Object.entries(t.deps||{}).map(([t,e])=>{if(t===f)return;const s=e.startsWith("_")?r.hash+e:e;return n.sa.load(s).then(e=>{p[t]=e})});await Promise.all(e)}const w=[];s.unppp(t.props||{},[(t,e,r)=>{if("ref"===t.__class)return w.push(t.id),{}}]);const m=await Promise.all(w.map(t=>n.sa.load((t=>"i"===t[1]||"o"===t[1]?a+t:t)(t)))),y=s.unppp(t.props||{},[(t,e,r)=>{if("ref"===t.__class)return m.shift()}]);return Object.keys(y).forEach(t=>{d[t]=y[t]}),d}ke(){this.ed={ck:[],creates:new Set,ea:new Set,es:new Map,error:!1,enforce:!0,oe:new Map,locals:new WeakMap};const t={console:this.ns,ed:this.ed,code:this,util:s};this.Jig=this.sandbox(Jig,Jig.toString(),"Jig",t,!0)[0],this.ll.set(Jig,this.Jig),this.ll.set(this.Jig,this.Jig)}sandbox(t,e,r,s,o){const i=this.ll.get(t);if(s.global={},i)return[i,null];if(!(o=o instanceof RegExp?o.test(r):o)&&t)return Object.keys(s).forEach(t=>{global[t]=s[t]}),[t,global];{!function(t){["Date","Math","eval","XMLHttpRequest","FileReader","WebSocket","setTimeout","setInterval"].forEach(e=>{void 0===t[e]&&(t[e]=void 0)})}(s);const t=n.createContext(s);"undefined"==typeof window&&(t.global=t);const o=`with(global){${e};${r}}`;return[n.runInContext(o,t),s.global]}}activate(t){const e="main"===t?"Mainnet":"test"===t?"Testnet":"stn"===t?"Stn":"Mocknet";this.ll.forEach((t,r)=>{"string"!=typeof r&&(void 0!==r[`origin${e}`]?(r.origin=r[`origin${e}`],t.origin=r[`origin${e}`]):(delete r.origin,delete t.origin),void 0!==r[`location${e}`]?(r.location=r[`location${e}`],t.location=r[`location${e}`]):(delete r.location,delete t.location),void 0!==r[`owner${e}`]?(r.owner=r[`owner${e}`],t.owner=r[`owner${e}`]):(delete r.owner,delete t.owner))})}flush(){this.ll=new Map,this.ll.set(Jig,this.Jig),this.ll.set(this.Jig,this.Jig)}}},function(t,e){t.exports=require("vm")},function(t,e){t.exports=require("vm-browserify")},function(t,e){t.exports=class Jig{constructor(...t){const e=util.run();if(!code.nx(this.constructor)){e.sa.begin();try{return new(code.deploy(this.constructor))(...t)}finally{e.sa.end()}}const r=[];let n=this.constructor;for(;n!==Jig;)r.push(n),n=Object.getPrototypeOf(n);if(0===r.length)throw new Error("Jig must be extended");if(r.some(t=>t.toString().includes(" constructor(")))throw new Error("Jig must use init() instead of constructor()");const s=["origin","location","owner","satoshis","sync","toJSON"];r.forEach(t=>{s.forEach(t=>{if(Object.prototype.hasOwnProperty.call(r[0].prototype,t))throw new Error(`must not override ${t}`)})});const o=[];[...r,Jig].forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(t=>o.push(t))});const i=[...o,"owner","satoshis","origin","location"];function a(){ed.creates=new Set,ed.ea=new Set,ed.es=new Map,ed.oe=new Map,ed.enforce=!0,ed.error=!1}const c=()=>{if(this.origin&&"!"===this.origin[0])throw new Error(`${this.origin.slice(1)}`)},u={el:!0,nt:!1},h=this,f=new Proxy(this,u);return Object.assign(u,{getPrototypeOf:t=>(c(),ed.oe.set(t,f),Object.getPrototypeOf(t)),setPrototypeOf(t,e){throw new Error("setPrototypeOf disallowed")},isExtensible:t=>!0,preventExtensions(t){throw new Error("preventExtensions disallowed")},getOwnPropertyDescriptor(t,e){if(c(),ed.oe.set(t,f),!this.has(t,e))return;const r=Object.getOwnPropertyDescriptor(t,e);if(!r)return;const n=this.get(t,e);return{...r,value:n}},defineProperty(t,e,r){throw new Error("defineProperty disallowed")},has(t,e){if(c(),ed.oe.set(t,f),"_"===e[0]&&ed.ck.length&&ed.ck[ed.ck.length-1].constructor!==f.constructor)throw new Error(`cannot check ${e} because it is private`);return ed.ck.length&&(!this.el||!i.includes(e))&&ed.ea.add(h),void 0!==t[e]},get(t,e,r){c(),ed.oe.set(t,f);if(this.el&&ed.enforce&&["location"].includes(e)&&ed.ck.length)throw new Error(`${e} may only be read externally`);if(this.el&&ed.enforce&&["origin","location"].includes(e)&&"_"===t[e][0])throw new Error(`sync required before reading ${e}`);if(this.el&&["origin","constructor","toJSON"].includes(e))return t[e];const n=this.el&&"function"==typeof t[e];if(ed.ck.length&&!n&&ed.ea.add(h),"_"===e[0]&&ed.ck.length&&ed.ck[ed.ck.length-1].constructor!==f.constructor)throw new Error(`cannot get ${e} because it is private`);return["undefined","boolean","number","string","symbol"].includes(typeof t[e])?t[e]:e===Symbol.iterator?t[e]:"object"==typeof t[e]?null===t[e]?null:t[e]instanceof Jig?t[e]:new Proxy(t[e],{...this,el:!1}):util.dy(t[e])?t[e]:(...r)=>{if(!this.el){const n=["concat","entries","every","filter","find","findIndex","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"],s=(t,e)=>Array.isArray(t)&&n.includes(e);if(!(ed.ck.length&&ed.ck[ed.ck.length-1]===h||s(t,e)))throw new Error(`internal method ${e} cannot be called externally`);return t[e](...r)}if("_"===e[0]&&(!ed.ck.length||ed.ck[ed.ck.length-1].constructor!==f.constructor))throw new Error(`cannot call ${e} because it is private`);if("sync"===e){if(ed.ck.length)throw new Error("sync may only be called externally");return t[e].call(f,...r)}const n=util.run();n.sa.begin(),ed.ck.push(h);try{if("init"===e&&this.nt)throw new Error("init cannot be called twice");"init"===e&&(this.nt=!0,ed.creates.add(t));const s=new Set(ed.ea);ed.enforce=!1;const o=[],i=util.ppp(r,[util.jrp(Jig,o),util.crp(o,t=>code.deploy(t))]);if(!ed.es.has(t)){const e={refs:[]},r=util.jrp(Jig,e.refs,!0),n=util.crp(e.refs,t=>code.deploy(t));e.value=util.ppp(t,[r,n]),ed.es.set(t,e)}ed.enforce=!0,ed.ea=s;const c=util.unppp(i,[util.rfu(o)]),u=t[e].call(f,...c);if("init"===e&&void 0!==u)throw new Error("init must not return");if(n.sa.kw(t.owner),n.sa.ks(t.satoshis),ed.error)throw new Error("internal error");if(1===ed.ck.length){const s=new Set(ed.ea);ed.enforce=!1;const o=new Map;ed.ea.forEach(t=>{const e=[],r=[util.jrp(Jig,e,!0),util.crp(e)];o.set(t,{value:util.ppp(t,r),refs:e})}),Array.from(ed.es.keys()).forEach(t=>{const e=[],r=[util.jrp(Jig,e,!0),util.crp(e)];o.set(t,{value:util.ppp(t,r),refs:e})});const i=(t,e)=>util.dsa(t.value,e.value)||t.refs.some((t,r)=>t!==e.refs[r]),c=Array.from(ed.es.entries()).filter(([t,e])=>i(e,o.get(t)));if(ed.enforce=!0,ed.ea=s,ed.creates.size||c.length){const s=new Set,i=new Set,a=new Set(ed.ea);c.forEach(([t,e])=>{i.add(t),ed.creates.has(t)||s.add(t)}),ed.creates.forEach(t=>i.add(t)),n.sa.storeAction(t,e,r,s,i,a,ed.es,o,ed.oe)}a()}return u}catch(t){throw ed.error=!0,1===ed.ck.length&&(ed.es.forEach((t,e)=>{Object.keys(e).forEach(t=>delete e[t]),Object.assign(e,util.unppp(t.value,[util.rfu(t.refs)]))}),a()),t}finally{ed.ck.pop(),n.sa.end()}}},set(t,e,r,n){c(),ed.oe.set(t,f);const s=["origin","location","toJSON",...o];if(ed.enforce&&this.el&&s.includes(e))throw new Error(`must not set ${e}`);if(!util.dy(t[e])&&"function"==typeof t[e])throw new Error(`must not set method ${e}`);if(ed.enforce&&(!ed.ck.length||ed.ck[ed.ck.length-1]!==h))throw new Error("properties cannot be set outside of methods");return t[e]=r,!0},deleteProperty(t,e){c(),ed.oe.set(t,f);const r=["origin","location",...o];if(this.el&&r.includes(e))throw new Error(`must not delete ${e}`);if(!util.dy(t[e])&&"function"==typeof t[e])throw new Error(`must not set method ${e}`);if(ed.enforce&&(!ed.ck.length||ed.ck[ed.ck.length-1]!==h))throw new Error("properties cannot be deleted outside of methods");return delete t[e],!0},ownKeys:t=>(c(),ed.oe.set(t,f),ed.ck.length&&ed.ea.add(h),ed.ck.length&&ed.ck[ed.ck.length-1].constructor!==f.constructor?Reflect.ownKeys(t).filter(t=>"_"!==t[0]):Reflect.ownKeys(t))}),this.owner=ed.ck.length?ed.ck[ed.ck.length-1].owner:e.sa.owner,this.satoshis=0,f.init(...t),f}init(){}toString(){return`[jig ${this.constructor.name}]`}sync(t){return util.run().sa.sync({...t,target:this})}static[Symbol.hasInstance](t){const e=code.al(this);let r=Object.getPrototypeOf(t);for(;r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}}},function(t,e,r){const n=r(18);t.exports={Pay:class{async pay(t){}},Purse:class{constructor(t,e){this.privkey=t,this.address=this.privkey.toAddress(),this.blockchain=e}async pay(t){const e=await this.utxos(),r=t.outputs.reduce((t,e)=>t+e.satoshis,0),n=Math.max(1e3,t._estimateFee()+r);if(e.forEach(e=>{t._getInputAmount()<n&&t.from(e)}),t._getInputAmount()<n)throw new Error("not enough funds");return t.change(this.address).sign(this.privkey),t}async balance(){return(await this.utxos()).reduce((t,e)=>t+e.satoshis,0)}async utxos(){const t=await this.blockchain.utxos(this.address),e=await Promise.all(t.map(t=>this.blockchain.fetch(t.txid)));return t.filter((t,r)=>!n.ku(e[r],t.vout))}}}},function(t,e,r){const{Jig:Jig}=r(1);class Token extends Jig{init(t=0,e){if(this._checkAmount(t),e&&(!Array.isArray(e)||e.some(t=>t.constructor!==this.constructor)))throw new Error("bad tokens");if(this.amount=t,!e)return void(this.minter=this);let r=this.amount;for(;r;){const t=e.shift();if(!t)throw new Error("not enough funds");if(r>t.amount?(r-=t.amount,t.burn(t.amount)):(t.burn(r),r=0),this.minter||(this.minter=t.minter),this.minter.origin!==t.minter.origin)throw new Error("different minter")}}mint(t){if(this._checkAmount(t),this.amount+t>Number.MAX_SAFE_INTEGER)throw new Error("total too large");if(this.minter!==this)throw new Error("only the minter token may mint");return this.amount+=t,this}split(t){return this._checkAmount(t),new this.constructor(t,[this])}send(t,e){return this._checkAmount(t),this.amount===t&&this!==this.minter?(this.owner=e,this):this.split(t).send(t,e)}burn(t){if(this._checkAmount(t),t>this.amount)throw new Error("not enough to burn");if(this.amount-=t,!this.amount&&this!==this.minter){const t="029d11c250cc84a6ffbaf84fc28da82fc4deee214021bed2dcaa22d5193d22e273";this.send(this.amount,t)}return this}_checkAmount(t){if(t&&"number"!=typeof t)throw new Error("amount not a number");if(t&&t<0)throw new Error("amount negative");if(t&&t>Number.MAX_SAFE_INTEGER)throw new Error("amount too large");if(!Number.isInteger(t))throw new Error("amount not an integer")}}Token.originTestnet="49ddec40b2d7b03c7f145a6ae309414d00c1d3d83e92177aa9b272218964307d_o1",Token.locationTestnet="49ddec40b2d7b03c7f145a6ae309414d00c1d3d83e92177aa9b272218964307d_o1",Token.ownerTestnet="03d3c928a592de19a72bb834734e8be097b2216223ec1617c2c8748fd4900f8471",Token.originMainnet="92dffdbd400a9816911d77c73b98af4b03b20cca13c7a0a247fde9221bccc6aa_o1",Token.locationMainnet="92dffdbd400a9816911d77c73b98af4b03b20cca13c7a0a247fde9221bccc6aa_o1",Token.ownerMainnet="0352792e5215163d61cd1b1ed1b756700cb2f4a1daa0ead8488e4a87c6fcab8c70",t.exports=Token}]);