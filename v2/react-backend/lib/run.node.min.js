module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e,r){"use strict";var n=r(6),o=r(22),s=Object.prototype.toString;function i(t){return"[object Array]"===s.call(t)}function a(t){return null!==t&&"object"==typeof t}function c(t){return"[object Function]"===s.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),i(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}t.exports={isArray:i,isArrayBuffer:function(t){return"[object ArrayBuffer]"===s.call(t)},isBuffer:o,isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===s.call(t)},isFile:function(t){return"[object File]"===s.call(t)},isBlob:function(t){return"[object Blob]"===s.call(t)},isFunction:c,isStream:function(t){return a(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]=r}for(var n=0,o=arguments.length;n<o;n++)u(arguments[n],r);return e},deepMerge:function t(){var e={};function r(r,n){"object"==typeof e[n]&&"object"==typeof r?e[n]=t(e[n],r):e[n]="object"==typeof r?t({},r):r}for(var n=0,o=arguments.length;n<o;n++)u(arguments[n],r);return e},extend:function(t,e,r){return u(e,function(e,o){t[o]=r&&"function"==typeof e?n(e,r):e}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e,r){const n=r(18),o=r(51),s=r(55),i=r(56),a=r(3),{Purse:c}=r(57),u=r(58),h=r(2),{PrivateKey:f}=h;class l{constructor(t={}){this.version="0.3.3-alpha",this.network=t.network||"main",this.bsvNetwork="main"===this.network?"mainnet":"testnet",this.sandbox=t.sandbox||!0;const e=typeof t.app;if("undefined"!==e&&"string"!==e)throw new Error("app must be a string");this.app=t.app||"",this.aac(),this.activate();const r=t.owner||new f(this.bsvNetwork);this.owner=new u(r,this.bsvNetwork),"string"==typeof t.blockchain?this.blockchain=new n(this.network,t.blockchain):this.blockchain=t.blockchain||new n(this.network),"string"==typeof t.purse||void 0===t.purse||t.purse instanceof f||null===t.purse?this.purse=new c(new f(t.purse,this.bsvNetwork),this.blockchain):this.purse=t.purse,this.aasc=new s(this),this.transaction=new i(this),"mock"===this.network&&this.blockchain.fund(this.purse.address,1e8),this.sync()}async sync(){return this.owner.sync()}beginTransaction(){return this.transaction.begin(),this}endTransaction(){return this.transaction.end(),this}async deploy(t){return this.aad(),l.code.deploy(t),await this.sync(),t.location}async load(t){return this.aad(),this.transaction.load(t)}aad(){if(l.instance!==this)throw new Error("run instance is not active. call run.activate() first.")}activate(){return l.instance=this,h.Networks.defaultNetwork=this.bsvNetwork,l.code.activate(this.network),this}async aab(t){return this.owner.bsvPrivateKey&&t.sign(this.owner.bsvPrivateKey),t}aac(){h.Networks.defaultNetwork=this.bsvNetwork;const t=h.Transaction.prototype.sign;h.Transaction.prototype.sign=function(...e){const r=h.Transaction.Input.prototype.isValidSignature;h.Transaction.Input.prototype.isValidSignature=()=>!0;const n=t.call(this,...e);return h.Transaction.Input.prototype.isValidSignature=r,n}}}l.aaxb=a;let d=null;Object.defineProperty(l,"code",{get:()=>(d||(d=new o),d)});const p={configurable:!0,enumerable:!0};Object.defineProperty(l,"Jig",{...p,get:()=>l.code.Jig}),Object.defineProperty(l,"Token",{...p,get:()=>r(59)}),Object.defineProperty(global,"Jig",{...p,get:()=>l.Jig}),Object.defineProperty(global,"Token",{...p,get:()=>l.Token}),t.exports=l},function(t,e){t.exports=require("bsv")},function(t,e,r){const n=r(2),o=1e8;const s=0;function i(t){return t.outputs.length&&t.outputs[0].script.isSafeDataOut()&&7===t.outputs[0].script.chunks.length&&"run"===t.outputs[0].script.chunks[2].buf.toString("utf8")&&1===t.outputs[0].script.chunks[3].buf.length&&t.outputs[0].script.chunks[3].buf[0]===s}function a(t){return"function"==typeof t&&(/^class [A-Za-z0-9_]/.test(t.toString())||/^function [A-Za-z0-9_]/.test(t.toString()))&&-1===t.toString().indexOf("[native code]")}const c=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`1234567890-=~!@#$%^&*()_+,./;'[]\\<>?:\"{}|".split(""),u="t08sY]m'#$Dy1`}pCKrHG)f9[uq%3\\ha=!ZVMkJ-*L\"xz67R? W~@wdO:Ecg|ITe52.+{ovBj>(&,/Q4lA;^<NPnXSFi_Ub".split("");function h(t){const e=t.split("").map(t=>-1!==u.indexOf(t)?c[u.indexOf(t)]:t).join("");try{return JSON.parse(e)}catch(t){throw new Error(`unable to parse decrypted run data\n\n${t.toString()}\n\n${e}`)}}t.exports={aae:function(t){if("string"!=typeof t)throw new Error("owner must be a pubkey string");try{new n.PublicKey(t)}catch(t){throw new Error(`owner is not a valid public key\n\n${t}`)}},aaf:function(t){if("number"!=typeof t)throw new Error("satoshis must be a number");if(!Number.isInteger(t))throw new Error("satoshis must be an integer");if(isNaN(t)||!isFinite(t))throw new Error("satoshis must be finite");if(t<0)throw new Error("satoshis must be non-negative");if(t>o)throw new Error(`satoshis must be less than ${o}`)},aag:i,aah:function(t){if(!i(t))throw new Error(`not a run tx: ${t.hash}`);return h(t.outputs[0].script.chunks[5].buf.toString("utf8"))},aai:function(t,e){if(!i(t))return"other";if(0===e)return"rundata";const r=h(t.outputs[0].script.chunks[5].buf.toString("utf8"));return e>=1&&e<1+r.code.length?"code":e>=1+r.code.length&&e<1+r.code.length+r.jigs?"jig":"other"},aaj:function(t){const e=t.toString(),r=Object.getPrototypeOf(t);if(r.prototype){const n=/^class .+ extends .+ {/;return e.replace(n,`class ${t.name} extends ${r.name} {`)}return e},aak:a,aal:function(t){return JSON.stringify(t).split("").map(t=>-1!==c.indexOf(t)?u[c.indexOf(t)]:t).join("")},aam:h,aan:function t(e,n=[],o=null,s=null,i=[null]){switch(typeof e){case"undefined":return{$class:"undefined"};case"string":case"boolean":return e;case"number":if(isNaN(e)||!isFinite(e))throw new Error(`${e} cannot be serialized to json`);return e;case"symbol":throw new Error(`${e.toString()} cannot be serialized to json`)}if(null===e)return null;for(const t of n){const r=t(e,o,s);if(void 0!==r)return r}if("function"==typeof e)throw new Error(`${e} cannot be serialized to json`);if(-1!==i.indexOf(e))throw new Error(`circular reference detected: ${s}`);const a=Object.getPrototypeOf(Object.getPrototypeOf(e)),c=null===a,u=Array.isArray(e)&&null===Object.getPrototypeOf(a);if(c||u){const r=c?{}:[];return i.push(e),Object.keys(e).forEach(o=>{if(o.startsWith("$"))throw new Error("$ properties must not be defined");r[o]=t(e[o],n,r,o,i)}),i.pop(),r}const h=r(1).code.aayb.Uint8Array;if(e.constructor===h||e.constructor===Uint8Array)return{$class:"Uint8Array",base64Data:Buffer.from(e).toString("base64")};const f=e.constructor.name?e.constructor.name:e.toString();throw new Error(`${f} cannot be serialized to json`)},aao:function t(e,n=[],o=null,s=null,i=[null]){switch(typeof e){case"undefined":throw new Error("JSON should not contain undefined");case"string":case"boolean":return e;case"number":if(isNaN(e)||!isFinite(e))throw new Error(`JSON should not contain ${e}`);return e;case"function":throw new Error(`JSON should not contain ${e}`);case"symbol":throw new Error(`JSON should not contain ${e.toString()}`)}if(null===e)return null;if(-1!==i.indexOf(e))throw new Error(`circular reference detected: ${s}`);for(const t of n){const r=t(e,o,s);if(void 0!==r)return r}if("Uint8Array"===e.$class)return new(0,r(1).code.aayb.Uint8Array)(Buffer.from(e.base64Data,"base64"));if("undefined"===e.$class)return;const a=Object.getPrototypeOf(Object.getPrototypeOf(e)),c=null===a,u=Array.isArray(e)&&null===Object.getPrototypeOf(a);if(c||u){const r=c?{}:[];return i.push(e),Object.keys(e).forEach(o=>{if(o.startsWith("$"))throw new Error("$ properties must not be defined");r[o]=t(e[o],n,r,o,i)}),i.pop(),r}const h=e.constructor.name?e.constructor.name:e.toString();throw new Error(`JSON should not contain ${h}`)},aap:function(t){const{Jig:Jig}=r(1);return(e,r,n)=>{if(e instanceof Jig||a(e))return t.push(e),{$index:t.length-1}}},aaq:function(t){return e=>{if(void 0!==e.$index)return t[e.$index]}},aar:function t(e,r=[],n=null,o=null,s=new Set){Array.isArray(r)?r.forEach(t=>t(e,n,o)):r(e,n,o),"object"==typeof e&&e&&!s.has(e)&&(s.add(e),Object.keys(e).forEach(n=>{t(e[n],r,e,n,s)}))},aas:function(){const t=r(1);if(!t.instance)throw new Error("Run not instantiated");return t.instance},aat:function(t,e){return t===e||t.origin&&"_"!==t.origin[0]&&t.origin===e.origin},aau:function(t){return"main"===t?"Mainnet":"test"===t?"Testnet":"stn"===t?"Stn":"Mocknet"}}},function(t,e,r){"use strict";var n=r(0);function o(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,r){if(!e)return t;var s;if(r)s=r(e);else if(n.isURLSearchParams(e))s=e.toString();else{var i=[];n.forEach(e,function(t,e){null!=t&&(n.isArray(t)?e+="[]":t=[t],n.forEach(t,function(t){n.isDate(t)?t=t.toISOString():n.isObject(t)&&(t=JSON.stringify(t)),i.push(o(e)+"="+o(t))}))}),s=i.join("&")}if(s){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+s}return t}},function(t,e,r){"use strict";var n=r(10);t.exports=function(t,e,r,o,s){var i=new Error(t);return n(i,e,r,o,s)}},function(t,e,r){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}},function(t,e,r){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,r){"use strict";var n=r(0),o=r(27),s={"Content-Type":"application/x-www-form-urlencoded"};function i(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var a,c={adapter:("undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?a=r(28):"undefined"!=typeof XMLHttpRequest&&(a=r(42)),a),transformRequest:[function(t,e){return o(e,"Accept"),o(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(i(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)?(i(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],function(t){c.headers[t]={}}),n.forEach(["post","put","patch"],function(t){c.headers[t]=n.merge(s)}),t.exports=c},function(t,e,r){"use strict";var n=r(5);t.exports=function(t,e,r){var o=r.config.validateStatus;!o||o(r.status)?t(r):e(n("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(t,e,r){"use strict";t.exports=function(t,e,r,n,o){return t.config=e,r&&(t.code=r),t.request=n,t.response=o,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,aabc:this.aabc,config:this.config,code:this.code}},t}},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("https")},function(t,e,r){var n=r(14),o=r(11),s=r(12),i=r(29),a=r(30).Writable,c=r(31)("follow-redirects"),u={GET:!0,HEAD:!0,OPTIONS:!0,TRACE:!0},h=Object.create(null);function f(t,e){a.call(this),t.headers=t.headers||{},this._options=t,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t.host&&(t.hostname||(t.hostname=t.host),delete t.host),e&&this.on("response",e);var r=this;if(this._onNativeResponse=function(t){r._processResponse(t)},!t.pathname&&t.path){var n=t.path.indexOf("?");n<0?t.pathname=t.path:(t.pathname=t.path.substring(0,n),t.search=t.path.substring(n))}this._performRequest()}function l(t){var e={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(t).forEach(function(o){var s=o+":",a=r[s]=t[o],u=e[o]=Object.create(a);u.request=function(t,o){return"string"==typeof t?(t=n.parse(t)).maxRedirects=e.maxRedirects:t=Object.assign({protocol:s,maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},t),t.nativeProtocols=r,i.equal(t.protocol,s,"protocol mismatch"),c("options",t),new f(t,o)},u.get=function(t,e){var r=u.request(t,e);return r.end(),r}}),e}["abort","aborted","error","socket","timeout"].forEach(function(t){h[t]=function(e){this._redirectable.emit(t,e)}}),f.prototype=Object.create(a.prototype),f.prototype.write=function(t,e,r){if(!("string"==typeof t||"object"==typeof t&&"length"in t))throw new Error("data should be a string, Buffer or Uint8Array");"function"==typeof e&&(r=e,e=null),0!==t.length?this._requestBodyLength+t.length<=this._options.maxBodyLength?(this._requestBodyLength+=t.length,this._requestBodyBuffers.push({data:t,encoding:e}),this._currentRequest.write(t,e,r)):(this.emit("error",new Error("Request body larger than maxBodyLength limit")),this.abort()):r&&r()},f.prototype.end=function(t,e,r){"function"==typeof t?(r=t,t=e=null):"function"==typeof e&&(r=e,e=null);var n=this._currentRequest;this.write(t||"",e,function(){n.end(null,null,r)})},f.prototype.setHeader=function(t,e){this._options.headers[t]=e,this._currentRequest.setHeader(t,e)},f.prototype.removeHeader=function(t){delete this._options.headers[t],this._currentRequest.removeHeader(t)},["abort","flushHeaders","getHeader","setNoDelay","setSocketKeepAlive","setTimeout"].forEach(function(t){f.prototype[t]=function(e,r){return this._currentRequest[t](e,r)}}),["aborted","connection","socket"].forEach(function(t){Object.defineProperty(f.prototype,t,{get:function(){return this._currentRequest[t]}})}),f.prototype._performRequest=function(){var t=this._options.protocol,e=this._options.nativeProtocols[t];if(e){if(this._options.agents){var r=t.substr(0,t.length-1);this._options.agent=this._options.agents[r]}var o=this._currentRequest=e.request(this._options,this._onNativeResponse);for(var s in this._currentUrl=n.format(this._options),o._redirectable=this,h)s&&o.on(s,h[s]);if(this._isRedirect){var i=0,a=this._requestBodyBuffers;!function t(){if(i<a.length){var e=a[i++];o.write(e.data,e.encoding,t)}else o.end()}()}}else this.emit("error",new Error("Unsupported protocol "+t))},f.prototype._processResponse=function(t){this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:t.headers,statusCode:t.statusCode});var e=t.headers.location;if(e&&!1!==this._options.followRedirects&&t.statusCode>=300&&t.statusCode<400){if(++this._redirectCount>this._options.maxRedirects)return void this.emit("error",new Error("Max redirects exceeded."));var r,o=this._options.headers;if(307!==t.statusCode&&!(this._options.method in u))for(r in this._options.method="GET",this._requestBodyBuffers=[],o)/^content-/i.test(r)&&delete o[r];if(!this._isRedirect)for(r in o)/^host$/i.test(r)&&delete o[r];var s=n.resolve(this._currentUrl,e);c("redirecting to",s),Object.assign(this._options,n.parse(s)),this._isRedirect=!0,this._performRequest(),t.destroy()}else t.responseUrl=this._currentUrl,t.redirects=this._redirects,this.emit("response",t),this._requestBodyBuffers=[]},t.exports=l({http:o,https:s}),t.exports.wrap=l},function(t,e){t.exports=require("url")},function(t,e,r){function n(t){var r;function n(){if(n.enabled){var t=n,o=+new Date,s=o-(r||o);t.diff=s,t.prev=r,t.curr=o,r=o;for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];i[0]=e.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(r,n){if("%%"===r)return r;c++;var o=e.formatters[n];if("function"==typeof o){var s=i[c];r=o.call(t,s),i.splice(c,1),c--}return r}),e.formatArgs.call(t,i),(n.log||e.log||console.log.bind(console)).apply(t,i)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var r,n=0;for(r in t)n=(n<<5)-n+t.charCodeAt(r),n|=0;return e.colors[Math.abs(n)%e.colors.length]}(t),n.destroy=o,"function"==typeof e.init&&e.init(n),e.instances.push(n),n}function o(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.aabc||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var r;e.save(t),e.names=[],e.skips=[];var n=("string"==typeof t?t:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(t=n[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(r=0;r<e.instances.length;r++){var s=e.instances[r];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var r,n;for(r=0,n=e.skips.length;r<n;r++)if(e.skips[r].test(t))return!1;for(r=0,n=e.names.length;r<n;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=r(33),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e){e=e||{};var r={};return n.forEach(["url","method","params","data"],function(t){void 0!==e[t]&&(r[t]=e[t])}),n.forEach(["headers","auth","proxy"],function(o){n.isObject(e[o])?r[o]=n.deepMerge(t[o],e[o]):void 0!==e[o]?r[o]=e[o]:n.isObject(t[o])?r[o]=n.deepMerge(t[o]):void 0!==t[o]&&(r[o]=t[o])}),n.forEach(["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"],function(n){void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n])}),r}},function(t,e,r){"use strict";function n(t){this.message=t}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,t.exports=n},function(t,e,r){const{starApi:n,bitIndexApi:o,whatsOnChainApi:s,RestApi:i}=r(19),a=r(50);t.exports=class{constructor(t,e){if(e="bitindex"===e?o:"whatsonchain"===e?s:n,"main"===t)return new i(t,e);if("test"===t)return new i(t,e);if("stn"===t)return new i(t,e);if("mock"===t)return new a;throw new Error(`Unknown network: ${t}`)}async broadcast(t){}async fetch(t,e){}async utxos(t){}}},function(t,e,r){const n=r(20),{Address:o,Script:s,Transaction:i}=r(2);async function a(t){try{return await t}catch(t){const{config:e,response:r}=t;if(e&&e.url&&r&&r.data){const t=r.data.message?r.data.message.message||r.data.message:r.data,n=r.data.name&&t?`${r.data.name}: ${t}`:r.data.name||t;throw new Error(`${n}\n\n${e.method.toUpperCase()} ${e.url}`)}throw t}}function c(t){const e=new i(t.hex||t.rawtx);return e.time=1e3*t.time||Date.now(),t.blockhash&&t.blockhash.length&&(e.blockhash=t.blockhash),t.blocktime&&(e.blocktime=t.blocktime),t.blockheight&&(e.blockheight=t.blockheight),void 0!==t.confirmations&&(e.confirmations=t.confirmations),t.vout&&t.vout.forEach((t,r)=>{void 0!==t.spentTxId&&(e.outputs[r].spentTxId=t.spentTxId),void 0!==t.spentIndex&&(e.outputs[r].spentIndex=t.spentIndex),void 0!==t.spentHeight&&(e.outputs[r].spentHeight=t.spentHeight)}),e}const u="https://api.star.store",h={aav:t=>`${u}/v1/${t}/tx`,aaw:t=>({rawtx:t.toBuffer().toString("hex")}),aax:(t,e)=>`${u}/v1/${t}/tx/${e}`,aay:t=>c(t),aaz:(t,e)=>`${u}/v1/${t}/utxos/${e.toString()}`,aaab:(t,e)=>t},f={aav:t=>`https://api.bitindex.network/api/v3/${t}/tx/send`,aaw:t=>({rawtx:t.toBuffer().toString("hex")}),aax:(t,e)=>`https://api.bitindex.network/api/v3/${t}/tx/${e}`,aay:t=>{const e=c(t);return e.confirmations=e.confirmations||0,e},aaz:(t,e)=>`https://api.bitindex.network/api/v3/${t}/addr/${e.toString()}/utxo`,aaab:(t,e)=>t.map(t=>({...t,script:new s(t.scriptPubKey)}))},l={aav:t=>`https://api.whatsonchain.com/v1/bsv/${t}/tx/raw`,aaw:t=>({txhex:t.toBuffer().toString("hex")}),aax:(t,e)=>`https://api.whatsonchain.com/v1/bsv/${t}/tx/hash/${e}`,aay:t=>{const e=c(t);return e.confirmations=e.confirmations||0,e},aaz:(t,e)=>`https://api.whatsonchain.com/v1/bsv/${t}/address/${e.toString()}/unspent`,aaab:(t,e)=>t.map(t=>({txid:t.tx_hash,vout:t.tx_pos,satoshis:t.value,script:s.fromAddress(e)}))};t.exports={starApi:h,bitIndexApi:f,whatsOnChainApi:l,RestApi:class{constructor(t,e){this.network=t,this.api=e,this.bsvNetwork="main"===t?"mainnet":"testnet",this.axios=n.create({timeout:1e4}),this.aajc=new Map,this.aaic=100,this.aahc=15e5,this.aamc=[],this.aalc=6e5,this.aakc=new Map}async broadcast(t){if(0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());if(!0!==t.isFullySigned())throw new Error("tx not fully signed");await a(this.axios.post(this.api.aav(this.network),this.api.aaw(t)));const e=Date.now();if(t.time=e,t.aanc=e,t.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),this.aajc.set(t.hash,t),this.aajc.size>this.aaic){const t=this.aajc.keys().next().value;this.aajc.delete(t)}this.aamc=this.aamc.filter(t=>e-t.time<this.aalc),this.aamc.push(t)}async fetch(t,e=!1){const r=e?null:this.aajc.get(t);if(r&&Date.now()-r.aanc<this.aahc)return this.aajc.delete(t),this.aajc.set(t,r),r;const n=this.aakc.get(t);if(n)return new Promise((t,e)=>{n.push({resolve:t,reject:e})});this.aakc.set(t,[]);try{const e=(await a(this.axios.get(this.api.aax(this.network,t)))).data,r=this.api.aay(e);if(r.aanc=Date.now(),this.aajc.set(t,r),this.aajc.size>this.aaic){const t=this.aajc.keys().next().value;this.aajc.delete(t)}return this.aakc.get(t).forEach(t=>t.resolve(r)),r}catch(e){throw this.aakc.get(t).forEach(t=>t.reject(e)),e}finally{this.aakc.delete(t)}}async utxos(t){t=new o(t).toString();const e=this.aakc.get(t);if(e)return new Promise((t,r)=>{e.push({resolve:t,reject:r})});this.aakc.set(t,[]);try{const e=(await a(this.axios.get(this.api.aaz(this.network,t)))).data,r=this.api.aaab(e,t),n=this.aabb(r,t);return this.aakc.get(t).forEach(t=>t.resolve(n)),n}catch(e){throw this.aakc.get(t).forEach(t=>t.reject(e)),e}finally{this.aakc.delete(t)}}aabb(t,e){const r=Date.now();return this.aamc=this.aamc.filter(t=>r-t.time<this.aalc),this.aamc.forEach(r=>{r.outputs.forEach((n,o)=>{n.script.toAddress(this.bsvNetwork).toString()!==e||t.some(t=>t.txid===r.hash&&t.vout===o)||t.push({txid:r.hash,vout:o,script:n.script,satoshis:n.satoshis})})}),this.aamc.forEach(e=>{t=t.filter(t=>!e.inputs.some(e=>((t,e)=>t.prevTxId.toString("hex")===e.txid&&t.outputIndex===e.vout)(e,t)))}),t}}}},function(t,e,r){t.exports=r(21)},function(t,e,r){"use strict";var n=r(0),o=r(6),s=r(23),i=r(16);function a(t){var e=new s(t),r=o(s.prototype.request,e);return n.extend(r,s.prototype,e),n.extend(r,e),r}var c=a(r(8));c.Axios=s,c.create=function(t){return a(i(c.defaults,t))},c.Cancel=r(17),c.CancelToken=r(48),c.isCancel=r(7),c.all=function(t){return Promise.all(t)},c.spread=r(49),t.exports=c,t.exports.default=c},function(t,e){t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},function(t,e,r){"use strict";var n=r(0),o=r(4),s=r(24),i=r(25),a=r(16);function c(t){this.defaults=t,this.interceptors={request:new s,response:new s}}c.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method=t.method?t.method.toLowerCase():"get";var e=[i,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},c.prototype.getUri=function(t){return t=a(this.defaults,t),o(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],function(t){c.prototype[t]=function(e,r){return this.request(n.merge(r||{},{method:t,url:e}))}}),n.forEach(["post","put","patch"],function(t){c.prototype[t]=function(e,r,o){return this.request(n.merge(o||{},{method:t,url:e,data:r}))}}),t.exports=c},function(t,e,r){"use strict";var n=r(0);function o(){this.handlers=[]}o.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},o.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},o.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=o},function(t,e,r){"use strict";var n=r(0),o=r(26),s=r(7),i=r(8),a=r(46),c=r(47);function u(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return u(t),t.baseURL&&!a(t.url)&&(t.url=c(t.baseURL,t.url)),t.headers=t.headers||{},t.data=o(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||i.adapter)(t).then(function(e){return u(t),e.data=o(e.data,e.headers,t.transformResponse),e},function(e){return s(e)||(u(t),e&&e.response&&(e.response.data=o(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e,r){return n.forEach(r,function(r){t=r(t,e)}),t}},function(t,e,r){"use strict";var n=r(0);t.exports=function(t,e){n.forEach(t,function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])})}},function(t,e,r){"use strict";var n=r(0),o=r(9),s=r(4),i=r(11),a=r(12),c=r(13).http,u=r(13).https,h=r(14),f=r(40),l=r(41),d=r(5),p=r(10),g=/https:?/;t.exports=function(t){return new Promise(function(e,r){var w,m=function(t){clearTimeout(w),e(t)},y=function(t){clearTimeout(w),r(t)},b=t.data,x=t.headers;if(x["User-Agent"]||x["user-agent"]||(x["User-Agent"]="axios/"+l.version),b&&!n.isStream(b)){if(Buffer.isBuffer(b));else if(n.isArrayBuffer(b))b=Buffer.from(new Uint8Array(b));else{if(!n.isString(b))return y(d("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",t));b=Buffer.from(b,"utf-8")}x["Content-Length"]=b.length}var v=void 0;t.auth&&(v=(t.auth.username||"")+":"+(t.auth.password||""));var E=h.parse(t.url),k=E.protocol||"http:";if(!v&&E.auth){var C=E.auth.split(":");v=(C[0]||"")+":"+(C[1]||"")}v&&delete x.Authorization;var _=g.test(k),$=_?t.httpsAgent:t.httpAgent,O={path:s(E.path,t.params,t.paramsSerializer).replace(/^\?/,""),method:t.method.toUpperCase(),headers:x,agent:$,auth:v};t.socketPath?O.socketPath=t.socketPath:(O.hostname=E.hostname,O.port=E.port);var T,j=t.proxy;if(!j&&!1!==j){var A=k.slice(0,-1)+"_proxy",S=process.env[A]||process.env[A.toUpperCase()];if(S){var R=h.parse(S),P=process.env.no_proxy||process.env.NO_PROXY,I=!0;if(P)I=!P.split(",").map(function(t){return t.trim()}).some(function(t){return!!t&&("*"===t||("."===t[0]&&E.hostname.substr(E.hostname.length-t.length)===t&&t.match(/\./g).length===E.hostname.match(/\./g).length||E.hostname===t))});if(I&&(j={host:R.hostname,port:R.port},R.auth)){var F=R.auth.split(":");j.auth={username:F[0],password:F[1]}}}}if(j&&(O.hostname=j.host,O.host=j.host,O.headers.host=E.hostname+(E.port?":"+E.port:""),O.port=j.port,O.path=k+"//"+E.hostname+(E.port?":"+E.port:"")+O.path,j.auth)){var N=Buffer.from(j.auth.username+":"+j.auth.password,"utf8").toString("base64");O.headers["Proxy-Authorization"]="Basic "+N}var q=_&&(!j||g.test(j.protocol));t.transport?T=t.transport:0===t.maxRedirects?T=q?a:i:(t.maxRedirects&&(O.maxRedirects=t.maxRedirects),T=q?u:c),t.maxContentLength&&t.maxContentLength>-1&&(O.maxBodyLength=t.maxContentLength);var M=T.request(O,function(e){if(!M.aborted){var r=e;switch(e.headers["content-encoding"]){case"gzip":case"compress":case"deflate":r=204===e.statusCode?r:r.pipe(f.createUnzip()),delete e.headers["content-encoding"]}var n=e.req||M,s={status:e.statusCode,statusText:e.statusMessage,headers:e.headers,config:t,request:n};if("stream"===t.responseType)s.data=r,o(m,y,s);else{var i=[];r.on("data",function(e){i.push(e),t.maxContentLength>-1&&Buffer.concat(i).length>t.maxContentLength&&(r.destroy(),y(d("maxContentLength size of "+t.maxContentLength+" exceeded",t,null,n)))}),r.on("error",function(e){M.aborted||y(p(e,t,null,n))}),r.on("end",function(){var e=Buffer.concat(i);"arraybuffer"!==t.responseType&&(e=e.toString(t.responseEncoding)),s.data=e,o(m,y,s)})}}});M.on("error",function(e){M.aborted||y(p(e,t,null,M))}),t.timeout&&(w=setTimeout(function(){M.abort(),y(d("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",M))},t.timeout)),t.cancelToken&&t.cancelToken.promise.then(function(t){M.aborted||(M.abort(),y(t))}),n.isStream(b)?b.on("error",function(e){y(p(e,t,null,M))}).pipe(M):M.end(b)})}},function(t,e){t.exports=require("assert")},function(t,e){t.exports=require("stream")},function(t,e,r){"undefined"==typeof process||"renderer"===process.type?t.exports=r(32):t.exports=r(34)},function(t,e,r){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=r(15)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var r=this.useColors;if(t[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+t[0]+(r?"%c ":" ")+"+"+e.humanize(this.diff),!r)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var o=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(s=o))}),t.splice(s,0,n)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())},function(t,e){var r=1e3,n=60*r,o=60*n,s=24*o,i=365.25*s;function a(t,e,r){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}t.exports=function(t,e){e=e||{};var c,u=typeof t;if("string"===u&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*i;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*o;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===u&&!1===isNaN(t))return e.long?a(c=t,s,"day")||a(c,o,"hour")||a(c,n,"minute")||a(c,r,"second")||c+" ms":function(t){if(t>=s)return Math.round(t/s)+"d";if(t>=o)return Math.round(t/o)+"h";if(t>=n)return Math.round(t/n)+"m";if(t>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){var n=r(35),o=r(36);(e=t.exports=r(15)).init=function(t){t.inspectOpts={};for(var r=Object.keys(e.inspectOpts),n=0;n<r.length;n++)t.inspectOpts[r[n]]=e.inspectOpts[r[n]]},e.log=function(){return process.stderr.write(o.format.apply(o,arguments)+"\n")},e.formatArgs=function(t){var r=this.namespace;if(this.useColors){var n=this.color,o="[3"+(n<8?n:"8;5;"+n),s="  "+o+";1m"+r+" [0m";t[0]=s+t[0].split("\n").join("\n"+s),t.push(o+"m+"+e.humanize(this.diff)+"[0m")}else t[0]=(e.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+r+" "+t[0]},e.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},e.load=i,e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):n.isatty(process.stderr.fd)},e.colors=[6,2,3,4,5,1];try{var s=r(37);s&&s.level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}function i(){return process.env.DEBUG}e.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),n=process.env[e];return n=!!/^(yes|on|true|enabled)$/i.test(n)||!/^(no|off|false|disabled)$/i.test(n)&&("null"===n?null:Number(n)),t[r]=n,t},{}),e.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},e.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts)},e.enable(i())},function(t,e){t.exports=require("tty")},function(t,e){t.exports=require("util")},function(t,e,r){"use strict";const n=r(38),o=r(39),s=process.env;let i;function a(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===i)return 0;if(o("color=16m")||o("color=full")||o("color=truecolor"))return 3;if(o("color=256"))return 2;if(t&&!t.isTTY&&!0!==i)return 0;const e=i?1:0;if("win32"===process.platform){const t=n.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in s)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in s)||"codeship"===s.CI_NAME?1:e;if("TEAMCITY_VERSION"in s)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(s.TEAMCITY_VERSION)?1:0;if("truecolor"===s.COLORTERM)return 3;if("TERM_PROGRAM"in s){const t=parseInt((s.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(s.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(s.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(s.TERM)?1:"COLORTERM"in s?1:(s.TERM,e)}(t))}o("no-color")||o("no-colors")||o("color=false")?i=!1:(o("color")||o("colors")||o("color=true")||o("color=always"))&&(i=!0),"FORCE_COLOR"in s&&(i=0===s.FORCE_COLOR.length||0!==parseInt(s.FORCE_COLOR,10)),t.exports={supportsColor:a,stdout:a(process.stdout),stderr:a(process.stderr)}},function(t,e){t.exports=require("os")},function(t,e,r){"use strict";t.exports=(t,e)=>{e=e||process.argv;const r=t.startsWith("-")?"":1===t.length?"-":"--",n=e.indexOf(r+t),o=e.indexOf("--");return-1!==n&&(-1===o||n<o)}},function(t,e){t.exports=require("zlib")},function(t){t.exports=JSON.parse('{"_args":[["axios@0.19.0","/home/brenton/code/star/run"]],"_from":"axios@0.19.0","_id":"axios@0.19.0","_inBundle":false,"_integrity":"sha512-1uvKqKQta3KBxIz14F2v06AEHZ/dIoeKfbTRkK1E5oqjDnuEerLmYTgJB5AiQZHJcljpg1TuRzdjDR06qNk0DQ==","_location":"/axios","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"axios@0.19.0","name":"axios","escapedName":"axios","rawSpec":"0.19.0","saveSpec":null,"fetchSpec":"0.19.0"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/axios/-/axios-0.19.0.tgz","_spec":"0.19.0","_where":"/home/brenton/code/star/run","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"1.5.10","is-buffer":"^2.0.2"},"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"bundlesize":"^0.17.0","coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.0.2","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^20.1.0","grunt-karma":"^2.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^1.0.18","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^1.3.0","karma-chrome-launcher":"^2.2.0","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-opera-launcher":"^1.0.0","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^1.2.0","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^1.7.0","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^5.2.0","sinon":"^4.5.0","typescript":"^2.8.1","url-search-params":"^0.10.0","webpack":"^1.13.1","webpack-dev-server":"^1.14.1"},"homepage":"https://github.com/axios/axios","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test && bundlesize","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","version":"0.19.0"}')},function(t,e,r){"use strict";var n=r(0),o=r(9),s=r(4),i=r(43),a=r(44),c=r(5);t.exports=function(t){return new Promise(function(e,u){var h=t.data,f=t.headers;n.isFormData(h)&&delete f["Content-Type"];var l=new XMLHttpRequest;if(t.auth){var d=t.auth.username||"",p=t.auth.password||"";f.Authorization="Basic "+btoa(d+":"+p)}if(l.open(t.method.toUpperCase(),s(t.url,t.params,t.paramsSerializer),!0),l.timeout=t.timeout,l.onreadystatechange=function(){if(l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in l?i(l.getAllResponseHeaders()):null,n={data:t.responseType&&"text"!==t.responseType?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:t,request:l};o(e,u,n),l=null}},l.onabort=function(){l&&(u(c("Request aborted",t,"ECONNABORTED",l)),l=null)},l.onerror=function(){u(c("Network Error",t,null,l)),l=null},l.ontimeout=function(){u(c("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",l)),l=null},n.isStandardBrowserEnv()){var g=r(45),w=(t.withCredentials||a(t.url))&&t.xsrfCookieName?g.read(t.xsrfCookieName):void 0;w&&(f[t.xsrfHeaderName]=w)}if("setRequestHeader"in l&&n.forEach(f,function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete f[e]:l.setRequestHeader(e,t)}),t.withCredentials&&(l.withCredentials=!0),t.responseType)try{l.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&l.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){l&&(l.abort(),u(t),l=null)}),void 0===h&&(h=null),l.send(h)})}},function(t,e,r){"use strict";var n=r(0),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,r,s,i={};return t?(n.forEach(t.split("\n"),function(t){if(s=t.indexOf(":"),e=n.trim(t.substr(0,s)).toLowerCase(),r=n.trim(t.substr(s+1)),e){if(i[e]&&o.indexOf(e)>=0)return;i[e]="set-cookie"===e?(i[e]?i[e]:[]).concat([r]):i[e]?i[e]+", "+r:r}}),i):i}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function o(t){var n=t;return e&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return t=o(window.location.href),function(e){var r=n.isString(e)?o(e):e;return r.protocol===t.protocol&&r.host===t.host}}():function(){return!0}},function(t,e,r){"use strict";var n=r(0);t.exports=n.isStandardBrowserEnv()?{write:function(t,e,r,o,s,i){var a=[];a.push(t+"="+encodeURIComponent(e)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(o)&&a.push("path="+o),n.isString(s)&&a.push("domain="+s),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,r){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,r){"use strict";var n=r(17);function o(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new n(t),e(r.reason))})}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var t;return{token:new o(function(e){t=e}),cancel:t}},t.exports=o},function(t,e,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,r){const{Address:n,Transaction:o}=r(2);t.exports=class{constructor(){this.aapc=new Map,this.aaoc=[],this.aaqc=-1}async broadcast(t){if(0===t.inputs.length)throw new Error("tx has no inputs");if(0===t.outputs.length)throw new Error("tx has no outputs");if(t.getFee()<t.toBuffer().length)throw new Error("tx fee too low");if(!0!==t.verify())throw new Error(t.verify());if(!0!==t.isFullySigned())throw new Error("tx not fully signed");let e=this.aaoc.slice(0);const r=t=>e=>e.txid===t.prevTxId.toString("hex")&&e.vout===t.outputIndex;if(t.inputs.forEach((t,n)=>{if(!e.some(r(t)))throw new Error(`tx input ${n} missing or spent`);e=e.filter(e=>!r(t)(e))}),t.unconfirmedHeight=Math.max(...t.inputs.map(t=>{return this.aapc.get(t.prevTxId.toString("hex")).unconfirmedHeight+1})),t.unconfirmedHeight>25){throw new Error(`too-long-mempool-chain\n\n${"Use run.blockchain.block() to produce blocks on the mockchain."}`)}this.aaoc=this.aaoc.filter(e=>!t.inputs.some(t=>r(t)(e))),t.time=t.time||Date.now(),t.aaqc=-1,t.confirmations=0,this.aapc.set(t.hash,t),t.outputs.forEach(t=>{t.spentTxId=null,t.spentIndex=null,t.spentHeight=null}),t.inputs.forEach((e,r)=>{const n=this.aapc.get(e.prevTxId.toString("hex")).outputs[e.outputIndex];n.spentTxId=t.hash,n.spentIndex=r,n.spentHeight=-1}),t.outputs.forEach((e,r)=>this.aaoc.push({txid:t.hash,vout:r,script:e.script,satoshis:e.satoshis}))}async fetch(t,e=!1){const r=this.aapc.get(t);if(r)return r;throw new Error(`tx not found: ${t}`)}async utxos(t){const e=new n(t).toString();return this.aaoc.filter(t=>t.script.toAddress("testnet").toString()===e)}fund(t,e){const r=Math.random().toString(),s=(new o).addData(r).to(new n(t,"testnet"),e);s.time=Date.now(),s.confirmations=0,s.aaqc=-1,s.unconfirmedHeight=0,this.aapc.set(s.hash,s);const i=s.outputs[1];this.aaoc.push({txid:s.hash,vout:1,script:i.script,satoshis:i.satoshis})}block(){this.aaqc+=1;for(const t of this.aapc.values())if(-1===t.aaqc){t.aaqc=this.aaqc,t.unconfirmedHeight=0;for(const e of t.inputs){this.aapc.get(e.prevTxId.toString("hex")).outputs[e.outputIndex].spentHeight=this.aaqc}}}}},function(module,exports,__webpack_require__){const vm="undefined"==typeof window?__webpack_require__(52):__webpack_require__(53),Jig=__webpack_require__(54),util=__webpack_require__(3),bsv=__webpack_require__(2);function aacb(t){["Date","Math","eval","XMLHttpRequest","FileReader","WebSocket","setTimeout","setInterval"].forEach(e=>{void 0===t[e]&&(t[e]=void 0)})}module.exports=class Code{constructor(){this.aarc=new Map,"undefined"==typeof window||window.document.body||(window.document.body=document.createElement("body")),this.aayb={};this.aayb.console=vm.runInContext("Object.assign(...Object.entries(c).map(([k, f]) => ({ [k]: (...a) => f(...a) })))",vm.createContext({c:console})),this.aayb.Uint8Array=vm.runInContext("Uint8Array",vm.createContext({})),this.Uint8Array=Uint8Array,this.aagb()}aadb(t){const e=this.aarc.get(t);return e&&t===e}aaeb(t){return this.aadb(t)?t:this.aarc.get(t)}deploy(t){if(t===this.Jig)return t;if(!util.aak(t))throw new Error(`${t} is not deployable`);const e=this.aarc.get(t),r=util.aas(),n=util.aau(r.network);if(e&&Object.keys(e).includes(`origin${n}`)&&Object.keys(e).includes(`location${n}`))return e;const o=Object.keys(t);if(o.includes(`location${n}`)){const e=this.aarc.get(t[`location${n}`]);if(e)return e}if(o.includes("deps")&&!(t=>null===Object.getPrototypeOf(Object.getPrototypeOf(t)))(t.deps))throw new Error("deps must be an object");const s=["origin","location","originMainnet","locationMainnet","originTestnet","locationTestnet","originStn","locationStn","originMocknet","locationMocknet","owner","ownerMainnet","ownerTestnet","ownerStn","ownerMocknet"];s.forEach(e=>{if((e=>o.includes(e)&&"string"!=typeof t[e])(e))throw new Error(`${e} must be a string: ${t[e]}`)}),r.transaction.begin();try{const e={...this.aayb},i=Object.getPrototypeOf(t),a={...t.deps};if(i!==Object.getPrototypeOf(Object)){if(e[i.name]=this.deploy(i),a[i.name]&&a[i.name]!==i)throw new Error(`unexpected parent dependency ${i.name}`);i.name in a||i===this.aarc.get(Jig)||(a[i.name]=i)}const[c,u]=this.sandbox(t,util.aaj(t),t.name,e,r.sandbox);this.aarc.set(t,c),this.aarc.set(c,c);const h={},f=["deps",...s],l=o.filter(t=>!f.includes(t)),d=[];l.forEach(e=>{util.aan(t[e],[util.aap(d)],null,`${t.name}.${e}`),c[e]=h[e]=t[e]});const p=d.filter(t=>util.aak(t));if(o.includes(`origin${n}`)||o.includes(`location${n}`))o.includes(`origin${n}`)&&(c[`origin${n}`]=c.origin=t.origin=t[`origin${n}`]),c[`location${n}`]=c.location=t.location=t[`location${n}`]||t.origin,c[`owner${n}`]=c.owner=t.owner=t[`owner${n}`],this.aarc.set(c[`location${n}`],c);else{const e=r.network,o=o=>{r.network===e&&(t.origin=t.location=c.origin=c.location=o,t.owner=c.owner=t[`owner${n}`]),c[`origin${n}`]=c[`location${n}`]=o,t[`origin${n}`]=t[`location${n}`]=o,this.aarc.set(o,c)},s=()=>{r.network===e&&(delete t.origin,delete t.location,delete c.origin,delete c.location,delete t.owner,delete c.owner),delete t[`origin${n}`],delete t[`location${n}`],delete c[`origin${n}`],delete c[`location${n}`],delete t[`owner${n}`],delete c[`owner${n}`]},i=r.transaction.aalb(t,c,a,h,o,s);t[`origin${n}`]=t[`location${n}`]=i,c[`origin${n}`]=c[`location${n}`]=i,t[`owner${n}`]=c[`owner${n}`]=t.owner}return u&&Object.entries(a).forEach(([t,r])=>{if(r===i||r===e[i.name])return;Object.defineProperty(u,t,{configurable:!0,enumerable:!0,value:this.deploy(r)})}),p.forEach(t=>this.deploy(t)),l.forEach(t=>{this.aabd.aaac=!1,util.aar(c[t],(e,r,n)=>{const o=this.aaeb(e);o&&n&&(r[n]=o),o&&!n&&(c[t]=o)}),this.aabd.aaac=!0}),Object.keys(a).length&&(c.deps={},Object.keys(a).forEach(t=>{c.deps[t]=this.deploy(a[t])})),c}finally{r.transaction.end()}}async aafb(t,e,r,n,o){if(this.aarc.has(e))return this.aarc.get(e);const s=e.slice(0,64),i=parseInt(e.slice(66));if(r.outputs[i].script.toAddress(o).toString()!==new bsv.PublicKey(t.owner,o).toAddress().toString())throw new Error(`bad def owner: ${e}`);const a={...this.aayb},c=/^class \w* extends (\w*)[\s]*{/;let u=null;if(c.test(t.text)){u=t.text.match(c)[1];let e=(t.deps||{})[u];"Jig"===u&&void 0===e?a.Jig=this.Jig:(e.startsWith("_")&&(e=r.hash+e),a[u]=await n.transaction.load(e))}const h=t.text.match(/^(class|function) (\w+)[( ]/)[2],[f,l]=this.sandbox(null,t.text,h,a,n.sandbox);f.origin=f.location=e,f.owner=t.owner;const d=util.aau(n.network);if(f[`origin${d}`]=f[`location${d}`]=e,f[`owner${d}`]=t.owner,this.aarc.set(e,f),this.aarc.set(f,f),l){const e=Object.entries(t.deps||{}).map(([t,e])=>{if(t===u)return;const o=e.startsWith("_")?r.hash+e:e;return n.transaction.load(o).then(e=>{Object.defineProperty(l,t,{configurable:!0,enumerable:!0,value:e})})});await Promise.all(e)}t.deps&&(f.deps={},Object.keys(t.deps).forEach(t=>{f.deps[t]=l[t]||a[t]}));const p=[],g=util.aao(t.props||{},[(t,e,r)=>{if(void 0!==t.$ref)return p.push({location:t.$ref,parent:e,name:r}),{}}]),w=p.map(t=>n.transaction.load((t=>"i"===t[1]||"o"===t[1]?s+t:t)(t.location))),m=await Promise.all(w);return p.forEach(({location:t,parent:e,name:r},n)=>{e[r]=m[n]}),Object.assign(f,g),f}aagb(){this.aabd={aabc:[],aadc:new Set,aacc:new Set,aaec:new Map,aafc:new Map,error:!1,aaac:!0,aazb:new Map,aagc:new WeakMap};const t={...this.aayb,aabd:this.aabd,code:this,util:util};this.Jig=this.sandbox(Jig,Jig.toString(),"Jig",t,!0)[0],this.aarc.set(Jig,this.Jig),this.aarc.set(this.Jig,this.Jig)}sandbox(type,code,name,env,sandbox){const prev=this.aarc.get(type);if(prev)return[prev,null];sandbox=sandbox instanceof RegExp?sandbox.test(name):sandbox,sandbox&&(env.deps={});const aabd=this.aabd;if(Object.defineProperty(sandbox?env.deps:global,"caller",{configurable:!0,enumerable:!0,get:()=>aabd.aabc.length<2?null:aabd.aazb.get(aabd.aabc[aabd.aabc.length-2])}),!sandbox)return type=type||eval(`${code};${name}`),Object.keys(env).forEach(t=>{Object.defineProperty(global,t,{value:env[t],configurable:!0,enumerable:!0,writable:!0})}),[type,global];aacb(env);const context=vm.createContext(env);"undefined"==typeof window&&(context.global=context);const script=`with(deps){${code};${name}}`;return[vm.runInContext(script,context),env.deps]}activate(t){const e=util.aau(t);this.aarc.forEach((t,r)=>{"string"!=typeof r&&(void 0!==r[`origin${e}`]?(r.origin=r[`origin${e}`],t.origin=r[`origin${e}`]):(delete r.origin,delete t.origin),void 0!==r[`location${e}`]?(r.location=r[`location${e}`],t.location=r[`location${e}`]):(delete r.location,delete t.location),void 0!==r[`owner${e}`]?(r.owner=r[`owner${e}`],t.owner=r[`owner${e}`]):(delete r.owner,delete t.owner))})}flush(){this.aarc=new Map,this.aarc.set(Jig,this.Jig),this.aarc.set(this.Jig,this.Jig)}}},function(t,e){t.exports=require("vm")},function(t,e){t.exports=require("vm-browserify")},function(t,e){t.exports=class Jig{constructor(...t){const e=util.aas();if(!code.aadb(this.constructor)){e.transaction.begin();try{return new(code.deploy(this.constructor))(...t)}finally{e.transaction.end()}}const r=[];let n=this.constructor;for(;n!==Jig;)r.push(n),n=Object.getPrototypeOf(n);if(0===r.length)throw new Error("Jig must be extended");if(r.some(t=>t.toString().includes(" constructor(")))throw new Error("Jig must use init() instead of constructor()");const o=["origin","location","owner","satoshis","sync","toJSON"];r.forEach(t=>{o.forEach(t=>{if(Object.prototype.hasOwnProperty.call(r[0].prototype,t))throw new Error(`must not override ${t}`)})});const s=[];[...r,Jig].forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(t=>s.push(t))});const i=[...s,"owner","satoshis","origin","location"];function a(){aabd.aadc=new Set,aabd.aacc=new Set,aabd.aaec=new Map,aabd.aafc=new Map,aabd.aazb=new Map,aabd.aaac=!0,aabd.error=!1}const c=()=>{if(this.origin&&"!"===this.origin[0])throw new Error(`${this.origin.slice(1)}`)},u={aacd:!0,aadd:!1},h=this,f=new Proxy(this,u);return Object.assign(u,{getPrototypeOf:t=>(c(),aabd.aazb.set(t,f),Object.getPrototypeOf(t)),setPrototypeOf(t,e){throw new Error("setPrototypeOf disallowed")},isExtensible:t=>!0,preventExtensions(t){throw new Error("preventExtensions disallowed")},getOwnPropertyDescriptor(t,e){if(c(),aabd.aazb.set(t,f),!this.has(t,e))return;const r=Object.getOwnPropertyDescriptor(t,e);if(!r)return;const n=this.get(t,e);return{...r,value:n}},defineProperty(t,e,r){throw new Error("defineProperty disallowed")},has(t,e){if(c(),aabd.aazb.set(t,f),"_"===e[0]&&aabd.aabc.length&&aabd.aabc[aabd.aabc.length-1].constructor!==f.constructor)throw new Error(`cannot check ${e} because it is private`);return aabd.aabc.length&&(!this.aacd||!i.includes(e))&&aabd.aacc.add(h),e in t},get(t,e,r){c(),aabd.aazb.set(t,f);if(this.aacd&&aabd.aaac&&["origin","location"].includes(e)&&"_"===t[e][0])throw new Error(`sync required before reading ${e}`);if(this.aacd&&["origin","constructor","toJSON"].includes(e))return t[e];const n=this.aacd&&"function"==typeof t[e];if(aabd.aabc.length&&!n&&aabd.aacc.add(h),"_"===e[0]&&aabd.aabc.length&&aabd.aabc[aabd.aabc.length-1].constructor!==f.constructor)throw new Error(`cannot get ${e} because it is private`);return["undefined","boolean","number","string","symbol"].includes(typeof t[e])?t[e]:e===Symbol.iterator?t[e]:"object"==typeof t[e]?null===t[e]?null:t[e]instanceof Jig?t[e]:aabd.aaac?t[e].constructor===code.aayb.Uint8Array&&0===aabd.aabc.length?new code.Uint8Array(Array.from(t[e])):new Proxy(t[e],{...this,aacd:!1}):t[e]:"function"==typeof t[e]?util.aak(t[e])&&!s.includes(e)?t[e]:(...r)=>{if(!this.aacd){const n=["concat","entries","every","filter","find","findIndex","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"],o=(t,e)=>Array.isArray(t)&&n.includes(e);if(!(aabd.aabc.length&&aabd.aabc[aabd.aabc.length-1]===h||o(t,e)))throw new Error(`internal method ${e} cannot be called externally`);return t[e](...r)}if("_"===e[0]&&(!aabd.aabc.length||aabd.aabc[aabd.aabc.length-1].constructor!==f.constructor))throw new Error(`cannot call ${e} because it is private`);if("sync"===e){if(aabd.aabc.length)throw new Error("sync may only be called externally");return t[e].call(f,...r)}const n=util.aas();n.transaction.begin();const o=aabd.aafc.get(h)||new Set;aabd.aabc.forEach(t=>o.add(t)),aabd.aafc.set(h,o),aabd.aabc.push(h);try{if("init"===e&&this.aadd)throw new Error("init cannot be called twice");"init"===e&&(this.aadd=!0,aabd.aadc.add(t));const o=new Set(aabd.aacc);aabd.aaac=!1;const s=[],i=t=>{util.aak(t)&&code.deploy(t)},c=[i,util.aap(s)],u=util.aan(r,c);if(!aabd.aaec.has(t)){const e={refs:[]},r=[i,util.aap(e.refs)];e.value=util.aan({...t},r),aabd.aaec.set(t,e)}aabd.aaac=!0,aabd.aacc=o;const h=util.aao(u,[util.aaq(s)]);let l=t[e].call(f,...h);if("init"===e&&void 0!==l)throw new Error("init must not return");if(l&&l instanceof code.aayb.Uint8Array&&1===aabd.aabc.length){const t=[];l.forEach(e=>t.push(e)),l=new code.Uint8Array(t)}if(util.aae(t.owner),util.aaf(t.satoshis),aabd.error)throw new Error("internal error");if(1===aabd.aabc.length){const o=new Set(aabd.aacc);aabd.aaac=!1;const s=new Map;aabd.aacc.forEach(t=>{const e=[],r=[util.aap(e)];s.set(t,{value:util.aan({...t},r),refs:e})}),Array.from(aabd.aaec.keys()).forEach(t=>{const e=[],r=[util.aap(e)];s.set(t,{value:util.aan({...t},r),refs:e})});const i=[];for(const[t,e]of aabd.aaec){const r=s.get(t),n=(t,e)=>t!==r.refs[e];(JSON.stringify(e.value)!==JSON.stringify(r.value)||e.refs.some(n))&&i.push(t)}if(aabd.aaac=!0,aabd.aacc=o,aabd.aadc.size||i.length){const o=new Set,a=new Set,c=new Set(aabd.aacc),u=t=>{a.add(t),aabd.aadc.has(t)||o.add(t)};i.forEach(t=>{aabd.aafc.get(t).forEach(t=>u(t)),u(t)}),aabd.aadc.forEach(t=>{aabd.aafc.get(t).forEach(t=>u(t)),u(t)}),n.transaction.aamb(t,e,r,o,a,c,aabd.aaec,s,aabd.aazb)}a()}return l}catch(t){throw aabd.error=!0,1===aabd.aabc.length&&(aabd.aaec.forEach((t,e)=>{Object.keys(e).forEach(t=>delete e[t]),Object.assign(e,util.aao(t.value,[util.aaq(t.refs)]))}),a()),t}finally{aabd.aabc.pop(),n.transaction.end()}}:void 0},set(t,e,r,n){c(),aabd.aazb.set(t,f);const o=["origin","location","toJSON",...s];if(aabd.aaac&&this.aacd&&o.includes(e))throw new Error(`must not set ${e}`);if(!util.aak(t[e])&&"function"==typeof t[e])throw new Error(`must not set method ${e}`);if(aabd.aaac&&(!aabd.aabc.length||aabd.aabc[aabd.aabc.length-1]!==h))throw new Error("properties cannot be set outside of methods");return t[e]=r,!0},deleteProperty(t,e){c(),aabd.aazb.set(t,f);const r=["origin","location",...s];if(this.aacd&&r.includes(e))throw new Error(`must not delete ${e}`);if(!util.aak(t[e])&&"function"==typeof t[e])throw new Error(`must not set method ${e}`);if(aabd.aaac&&(!aabd.aabc.length||aabd.aabc[aabd.aabc.length-1]!==h))throw new Error("properties cannot be deleted outside of methods");return delete t[e],!0},ownKeys:t=>(c(),aabd.aazb.set(t,f),aabd.aabc.length&&aabd.aacc.add(h),aabd.aabc.length&&aabd.aabc[aabd.aabc.length-1].constructor!==f.constructor?Reflect.ownKeys(t).filter(t=>"_"!==t[0]):Reflect.ownKeys(t))}),e.transaction.stateToInject?(Object.assign(this,e.transaction.stateToInject),f):(this.owner=aabd.aabc.length?aabd.aabc[aabd.aabc.length-1].owner:e.transaction.owner,this.satoshis=0,this.origin="_",this.location="_",f.init(...t),f)}init(){}toString(){return`[jig ${this.constructor.name}]`}sync(t){return util.aas().aasc.sync({...t,target:this})}static[Symbol.hasInstance](t){if("object"!=typeof t||!("location"in t))return!1;let e=code.aaeb(this);if(!e){const t=util.aas(),r=util.aau(t.network);if(!(e=code.aaeb(this[`origin${r}`])))return!1}let r=Object.getPrototypeOf(t);for(;r;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1}}},function(t,e,r){const n=r(2),o=r(3);t.exports=class{constructor(t){this.run=t,this.blockchain=t.blockchain,this.code=t.constructor.code,this.bsvNetwork=t.bsvNetwork,this.pay=(...e)=>t.purse.pay(...e),this.sign=(...e)=>t.aab(...e),this.aaad=[],this.aaxc=[],this.aazc=new Map,this.aayc=new Set,this.aawc=new Map,this.aavc=300}aakb(t){for(const[e,r]of t.locations)this.aazc.has(e)||this.aazc.set(e,r);this.aaad.push(t),1===this.aaad.length&&this.aajb().catch(t=>{})}async aajb(){const t=this.aaad[0];if(!t.actions.length&&!t.code.length)return this.aaib();let e=null;try{const s=t.inputs.filter(t=>"_"!==t.origin[0]),i=new Map;t.aacc.forEach(e=>{if(s.includes(e)||t.outputs.includes(e))return;const r=this.aazc.get(e.origin)||e.location,n=i.get(e.origin);if(n&&n!==r)throw new Error(`read different locations of same jig ${e.origin}`);i.set(e.origin,r)});const a=Array.from(i.values()),{Jig:Jig}=r(1),c=e=>{if(e instanceof Jig){const r=Array.from(t.aazb.entries()).filter(([t,r])=>r===e).map(([t,e])=>t);r.length&&(e=r[0]);const n=s.findIndex(t=>o.aat(t,e));if(-1!==n)return{$ref:`_i${n}`};const c=t.outputs.findIndex(t=>o.aat(t,e));if(-1!==c)return{$ref:`_o${1+t.code.length+c}`};const u=a.indexOf(i.get(e.origin));return-1!==u?{$ref:`_r${u}`}:{$ref:this.aazc.get(e.origin)||e.location}}},u=o.aau(this.run.network),h=t=>{if(o.aak(t)){return{$ref:"_"===t[`location${u}`][0]?`_o${parseInt(t[`location${u}`].slice(2))+1}`:t[`location${u}`]}}},f=t.actions.map(e=>{const{method:r}=e,n=o.aan(e.args,[c,h]);if("init"===r){const t=e.target.constructor[`origin${u}`]||e.target.constructor[`location${u}`];return{target:"_"===t[0]?`_o${1+parseInt(t.slice(2))}`:t,method:r,args:n,creator:e.creator}}const i=s.findIndex(t=>o.aat(t,e.target));if(-1!==i)return{target:`_i${i}`,method:r,args:n};const a=t.outputs.findIndex(t=>o.aat(t,e.target));return-1!==a?{target:`_o${1+t.code.length+a}`,method:r,args:n}:{target:"_"!==e.target.location[0]?e.target.location:this.aazc.get(e.target.origin),method:r,args:n}}),l={code:t.code.map(t=>{const e=t=>"_"===t[0]?`_o${1+parseInt(t.slice(2))}`:t,r=Object.entries(t.deps).map(([t,r])=>({[t]:e(r[`location${u}`])})),n=r.length?Object.assign(...r):void 0;let s;return Object.keys(t.props).length&&(s=o.aan(t.props,[c,h])),{text:o.aaj(t.type),deps:n,props:s,owner:t.owner}}),actions:f,jigs:t.outputs.length,refs:a.length?a:void 0},d=o.aal(l),p=Buffer.from("run","utf8"),g=Buffer.from([0],"hex"),w=Buffer.from(this.run.app,"utf8"),m=Buffer.from(d,"utf8"),y=Buffer.from("r12w","utf8"),b=n.Script.buildSafeDataOut([p,g,w,m,y]);e=(new n.Transaction).addOutput(new n.Transaction.Output({script:b,satoshis:0}));const x=a.map(t=>t.slice(0,64)),v=a.map(t=>parseInt(t.slice(66)));(x.length?await Promise.all(x.map(t=>this.blockchain.fetch(t))):[]).forEach((t,e)=>{if(void 0===t.outputs[v[e]].spentTxId)throw new Error(`Read ${a[e]} may not be latest. Blockchain did not return spentTxId. Aborting.`);if(null!==t.outputs[v[e]].spentTxId)throw new Error(`Read ${a[e]} is not the latest. Must sync() jigs`)});const E=s.map(t=>this.aazc.get(t.origin)||t.location),k=E.length?await Promise.all(E.map(t=>this.blockchain.fetch(t.slice(0,64)))):[];s.forEach((t,r)=>{const n=E[r].slice(0,64),o=parseInt(E[r].slice(66)),s=k[r].outputs[o],i={txid:n,vout:o,script:s.script,satoshis:s.satoshis};e.from(i)});const C=t=>new n.PublicKey(t.owner,{network:this.bsvNetwork});t.code.forEach(t=>e.to(C(t),n.Transaction.DUST_AMOUNT)),t.outputs.forEach(r=>{const o=t.stateAfter.get(r).value.owner,s=new n.PublicKey(o,{network:this.bsvNetwork}).toAddress(),i=t.stateAfter.get(r).value.satoshis;e.to(s,Math.max(n.Transaction.DUST_AMOUNT,i))}),e=await this.pay(e),e=await this.sign(e);for(let t=0;t<s.length;t++)if(!e.inputs[t].isFullySigned())throw new Error(`signature missing for ${s[t].constructor.name}\n\norigin: ${s[t].origin}\nlocation: ${E[t]}\nowner: ${s[t].owner}`);await this.blockchain.broadcast(e),this.aayc.forEach(t=>t(e))}catch(t){const e=0===this.aaxc.length;return e&&console.error(t),this.aaxc.forEach(e=>e.reject(t)),this.aaxc=[],this.aaad.forEach(r=>{r.code.forEach(t=>t.error()),r.code.forEach(t=>this.run.owner.aawb(t.sandbox)),r.outputs.forEach(n=>{if("_"===n.origin[0]||e){const e=`!${"_"===n.origin[0]?"deploy failed":"a previous update failed"}\n\n${t}`;return Object.keys(n).forEach(t=>delete n[t]),void(n.origin=n.location=e)}if("_"!==n.location[0])return;const s=n.origin;Object.keys(n).forEach(t=>delete n[t]);const i=o.aaq(r.stateBefore.get(n).refs);Object.assign(n,o.aao(r.stateBefore.get(n).value,[i])),n.origin=s,n.location=this.aazc.get(s),this.run.owner.aawb(r.aazb.get(n))})}),this.aaad=[],void(this.aazc=new Map)}const s=t=>this.aaad.slice(1).some(e=>e.outputs.some(e=>o.aat(t,e)));t.outputs.forEach((r,n)=>{const o=1+t.code.length+n;"_"===r.origin[0]&&(r.origin=`${e.hash}_o${o}`),s(r)?this.aazc.set(r.origin,`${e.hash}_o${o}`):(r.location=`${e.hash}_o${o}`,this.aazc.delete(r.origin)),t.stateAfter.get(r).value.origin=r.origin,t.stateAfter.get(r).value.location=`${e.hash}_o${o}`}),t.code.forEach((t,r)=>t.success(`${e.hash}_o${r+1}`)),t.outputs.forEach(n=>{const s=t.stateAfter.get(n),i=o.aao(s.value,[o.aaq(s.refs)]),{Jig:Jig}=r(1),a=o.aan(i,[t=>{if(o.aak(t)||t instanceof Jig){const r=this.aazc.get(t.origin)||t.location;return{$ref:r.startsWith(e.hash)?r.slice(64):r}}}]),c={type:n.constructor.origin,state:a};if(this.aawc.set(s.value.location,c),this.aawc.size>this.aavc){const t=this.aawc.keys().next().value;this.aawc.delete(t)}}),t.code.forEach(t=>this.run.owner.aawb(t.sandbox)),t.outputs.forEach(e=>this.run.owner.aawb(t.aazb.get(e))),this.aaib()}async aaib(){this.aaad.shift(),this.aaad.length?this.aajb():(this.aaxc.forEach(t=>t.resolve()),this.aaxc=[])}async sync(t={}){const e=new Set,r=t=>e.add(t.hash);this.aayc.add(r);const n=async()=>t.target&&(void 0===t.forward||t.forward)?this.aahb(t.target,e).then(()=>t.target):t.target;if(!this.aaad.length)return n();return new Promise((t,e)=>{this.aaxc.push({resolve:t,reject:e})}).then(n).catch(t=>n().then(()=>{throw t}).catch(e=>{throw t})).finally(()=>this.aayc.delete(r))}async aahb(t,e=new Set,n=new Map){const s=n.get(t.origin);if(s)return this.code.aabd.aaac=!1,Object.assign(t,s),this.code.aabd.aaac=!0,t;let i=t.location.slice(0,64),a=parseInt(t.location.slice(66)),c=await this.blockchain.fetch(i,!e.has(i));for(e.add(i);;){const r=c.outputs[a];if(void 0===r.spentTxId){throw new Error(`${"Blockchain API does not support forward syncing."}\n\n${"To just publish pending transactions, use `jig.sync({ forward: false })`."}`)}if(null===r.spentTxId)break;c=await this.blockchain.fetch(r.spentTxId,!e.has(i)),e.add(r.spentTxId);const n=o.aah(c);if(!(await this.run.transaction.aaqb(c,n,t)).some(e=>e===t))throw new Error("jig not found");i=t.location.slice(0,64),a=parseInt(t.location.slice(66))}n.set(t.origin,t);const u=new Set,{Jig:Jig}=r(1);this.code.aabd.aaac=!1,o.aar(t,(t,e,r)=>{t&&t instanceof Jig&&r&&u.add(t)}),this.code.aabd.aaac=!0;for(const t of u)await this.aahb(t,e,n)}}},function(t,e,r){const n=r(2),o=r(3);t.exports=class{constructor(t){this.run=t,this.aasc=t.aasc,this.blockchain=t.blockchain,this.owner=t.owner.pubkey?t.owner.pubkey:null,this.code=t.constructor.code,this.bsvNetwork=t.bsvNetwork,this.aatc=this.aapb(),this.aauc=0}aapb(){return{code:[],actions:[],stateBefore:new Map,stateAfter:new Map,inputs:[],outputs:[],aacc:new Set,aazb:new Map,locations:new Map}}begin(){this.aauc++}end(){if(0===this.aauc)throw new Error("end transaction without begin");0==--this.aauc&&(this.aasc&&this.aasc.aakb(this.aatc),this.aatc=this.aapb())}aalb(t,e,r,n,o,s){this.begin();try{this.aatc.code.push({type:t,sandbox:e,deps:r,props:n,success:o,error:s,owner:this.owner});const i=`_d${this.aatc.code.length-1}`;return t.owner=e.owner=this.owner,this.run.owner.aawb(this.code.aaeb(t)),i}finally{this.end()}}aamb(t,e,r,n,s,i,a,c,u){this.begin();try{const h=new Map,f=t=>{const e=t=>void 0!==t.origin&&"_"!==t.origin[0],r=h.get(e(t)?t.origin:t);if(!r)return h.set(e(t)?t.origin:t,t.location);if(r!==t.location)throw new Error(`referenced different locations of same jig: ${t}`)};f(t),n.forEach(t=>f(t)),s.forEach(t=>f(t)),i.forEach(t=>f(t)),a.forEach((t,e)=>{this.aatc.stateBefore.set(e,this.aatc.stateBefore.get(e)||t)}),c.forEach((t,e)=>{this.aatc.stateAfter.set(e,t)}),n.forEach(t=>{if(this.aatc.inputs.some(e=>o.aat(t,e)&&e.location!==t.location))throw new Error("different instances of the same jig");this.aatc.inputs.some(e=>o.aat(t,e))||this.aatc.inputs.push(t)}),s.forEach(t=>{const e=this.aatc.outputs.findIndex(e=>o.aat(t,e));if(-1!==e)return t.location=`_o${e}`,void(t.origin||(t.origin=t.location));this.aatc.outputs.push(t);(t=>t.origin&&"_"!==t.origin[0]&&t.location&&"_"!==t.location[0]&&!this.aatc.locations.has(t.origin))(t)&&this.aatc.locations.set(t.origin,t.location),t.location=`_o${this.aatc.outputs.length-1}`,t.origin||(t.origin=t.location)}),i.forEach(t=>this.aatc.aacc.add(t)),u.forEach((t,e)=>this.aatc.aazb.set(e,t));const l=a.get(t).value.owner;this.aatc.actions.push({target:t,method:e,creator:l,args:r,inputs:n,outputs:s,aacc:i})}finally{this.end()}s.forEach(t=>this.run.owner.aawb(u.get(t)))}async load(t,e=new Map){if("string"!=typeof t)throw new Error(`typeof location is ${typeof t} - must be string`);const r=this.code.aaeb(t);if(r)return r;const n=this.aasc.aawc.get(t);if(n){this.aasc.aawc.delete(t),this.aasc.aawc.set(t,n);const r=await this.load(n.type),s=t=>{if(void 0!==t.$ref)return t};this.stateToInject=o.aao(n.state,[s]);const i=new r;this.stateToInject=null,e.set(t,i);const a=e=>e.startsWith("_")?`${t.slice(0,64)}${e}`:e;o.aar(n.state,t=>{if(t&&t.$ref){const r=a(t.$ref);e.has(r)||e.set(r,null)}});const c=new Map(e);for(const[t,r]of c){if(r)continue;const n=await this.load(t,e);e.has(t)&&e.set(t,n)}return this.code.aabd.aaac=!1,o.aar(i,(t,r,n)=>{t&&t.$ref&&(r[n]=e.get(a(t.$ref)))}),this.code.aabd.aaac=!0,i}const s=t.slice(0,64),i=parseInt(t.slice(66));if(isNaN(i))throw new Error(`bad location: ${t}`);const a=await this.blockchain.fetch(s),c=o.aah(a);if(i>0&&i<c.code.length+1)return this.code.aafb(c.code[i-1],t,a,this.run,this.bsvNetwork);const u=await this.aaqb(a,c);if(void 0===u[i])throw new Error("not a jig output");return u[i]}async aaqb(t,e,s){const i=this.aapb(),a=new Map;e.refs&&e.refs.forEach(t=>a.set(t,t));for(const r of e.actions){const e=e=>{if("_"!==e[0]&&a.set(e,e),"i"===e[1]){const r=t.inputs[parseInt(e.slice(2))];a.set(e,`${r.prevTxId.toString("hex")}_o${r.outputIndex}`)}};r.target&&"init"!==r.method&&e(r.target);const n=t=>{void 0!==t.$ref&&e(t.$ref)};o.aar(r.args,n)}for(const[,e]of a){const r=await this.blockchain.fetch(e.slice(0,64)),n=parseInt(e.slice(66));if(void 0===r.outputs[n].spentTxId)throw new Error("Cannot check if read is stale. Blockchain API does not support spentTxId.");if(null===r.outputs[n].spentTxId)continue;const o=await this.blockchain.fetch(r.outputs[n].spentTxId);if(o.time<=t.time&&o.time>=r.time&&t.time-r.time>72e5&&t.hash!==o.hash)throw new Error(`${e} is stale. Aborting.`)}for(const[t,e]of a)if(s&&e===s.location)a.set(t,s);else try{a.set(t,await this.load(e))}catch(e){throw console.error(e),new Error(`bad ref ${t}\n\n${e.toString()}`)}const{Jig:Jig}=r(1),c=t=>{this.code.aabd.aaac=!1;o.aar(t,(t,e,r)=>{if(t&&t instanceof Jig){if(!e)return;const n=Array.from(a.values()).find(e=>e.origin===t.origin);n&&(e[r]=n)}}),this.code.aabd.aaac=!0};for(const t of a.values())c(t);for(const r of e.actions){const n=t=>{if(void 0!==t.$ref){if("_"!==t.$ref[0]||"i"===t.$ref[1]){const e=a.get(t.$ref);if(!e)throw new Error(`unexpected ref ${t.$ref}`);return e}if("r"===t.$ref[1]){const r=a.get(e.refs[parseInt(t.$ref.slice(2))]);if(!r)throw new Error(`unexpected ref ${t.$ref}`);return r}if("o"!==t.$ref[1])throw new Error(`unexpected ref ${t.$ref}`);const r=parseInt(t.$ref.slice(2))-1-e.code.length;return i.aazb.get(i.outputs[r])}};this.code.aabd.aaac=!1;const s=o.aao(r.args,[n]);if(this.code.aabd.aaac=!0,"init"===r.method){if("_"===r.target[0]){const t=parseInt(r.target.slice(2));if(t<=0||t>=e.code.length+1)throw new Error(`missing target ${r.target}`)}const n=await this.load("_"===r.target[0]?t.hash+r.target:r.target);this.aanb(r.creator,i);try{new n(...s)}finally{this.aaob()}}else{const t=a.get(r.target)||i.outputs[parseInt(r.target.slice(2))-1-e.code.length];if(c(t),void 0===t)throw new Error(`target ${r.target} missing`);this.aanb(null,i);try{t[r.method](...s)}catch(t){throw new Error(`unexpected exception in ${r.method}\n\n${t}`)}finally{this.aaob()}}}const u=i.inputs.filter(t=>"_"!==t.origin[0]);if(e.jigs!==i.outputs.length)throw new Error("bad number of jigs");if(t.inputs.length<u.length)throw new Error("not enough inputs");if(t.outputs.length<e.code.length+e.jigs+1)throw new Error("not enough outputs");u.forEach((e,r)=>{if(`${t.inputs[r].prevTxId.toString("hex")}_o${t.inputs[r].outputIndex}`!==(i.locations.get(e.origin)||e.location))throw new Error(`bad input ${r}`)}),i.outputs.forEach((r,o)=>{const s=1+e.code.length+o;if(new n.PublicKey(r.owner,{network:this.bsvNetwork}).toAddress().toString()!==t.outputs[s].script.toAddress(this.bsvNetwork).toString())throw new Error(`bad owner on output ${s}`);if(t.outputs[s].satoshis<Math.max(r.satoshis,n.Transaction.DUST_AMOUNT))throw new Error(`bad satoshis on output ${s}`)}),i.outputs.forEach(r=>{const n=`${t.hash}_o${1+e.code.length+parseInt(r.location.slice(2))}`;"_"===r.origin[0]&&(r.origin=n),"_"===r.location[0]&&(r.location=n)});const h=i.outputs.map(t=>i.aazb.get(t)),f=new Array(1+e.code.length).concat(h);for(let e=0;e<f.length;e++){if(!f[e])continue;const r=`${t.hash.slice(0,64)}_o${e}`;this.code.aabd.aaac=!1;const n=o.aan({...f[e]},[t=>{if(t instanceof Jig||o.aak(t))return{$ref:t.location}}]);this.code.aabd.aaac=!0;const s={type:f[e].constructor.origin,state:n};if(this.aasc.aawc.set(r,s),this.aasc.aawc.size>this.aasc.aavc){const t=this.aasc.aawc.keys().next().value;this.aasc.aawc.delete(t)}}return f}aanb(t,e){this.verify=[this.aatc,this.aasc,this.owner],this.aatc=e,this.aasc=null,this.owner=t}aaob(){[this.aatc,this.aasc,this.owner]=this.verify,delete this.verify}}},function(t,e,r){const n=r(2),o=r(3);t.exports={Pay:class{async pay(t){}},Purse:class{constructor(t,e){this.privkey=t,this.address=this.privkey.toAddress(),this.blockchain=e}async pay(t){let e=await this.blockchain.utxos(this.address);if(e.length<10){const t=e.reduce((t,e)=>t+e.satoshis,0),r=(new n.Transaction).from(e);for(let e=0;e<9;e++)r.to(this.address,Math.floor(t/10));r.change(this.address),r.sign(this.privkey),await this.blockchain.broadcast(r),e=await this.blockchain.utxos(this.address)}e=function(t){for(let e=t.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}(e);const r=t.outputs.reduce((t,e)=>t+e.satoshis,0),s=Math.max(1e3,t._estimateFee()+r);for(const r of e){const e=await this.blockchain.fetch(r.txid);if("other"===o.aai(e,r.vout)&&(t.from(r),t._getInputAmount()>=s))break}if(t._getInputAmount()<s)throw new Error("not enough funds");return t.change(this.address).sign(this.privkey),t}async balance(){return(await this.utxos()).reduce((t,e)=>t+e.satoshis,0)}async utxos(){const t=await this.blockchain.utxos(this.address),e=await Promise.all(t.map(t=>this.blockchain.fetch(t.txid)));return t.filter((t,r)=>"other"===o.aai(e[r],t.vout))}}}},function(t,e,r){const n=r(2),o=r(3);t.exports=class{constructor(t,e){try{const r=new n.PrivateKey(t,e);if(r.toString()!==t.toString())throw new Error;return this.aarb(r)}catch(t){if("Private key network mismatch"===t.message)throw t}try{return this.aasb(new n.PublicKey(t,{network:e}))}catch(t){}try{return this.aatb(new n.Address(t,e))}catch(t){if("Address has mismatched network type."===t.message)throw t}throw new Error(`bad owner key or address: ${t}`)}aarb(t){return this.bsvPrivateKey=t,this.privkey=t.toString(),this.aasb(t.publicKey)}aasb(t){return this.bsvPublicKey=t,this.pubkey=t.toString(),this.aatb(t.toAddress())}aatb(t){this.bsvAddress=t,this.address=t.toString(),this.refs=new Map;const e=r(1);return this.run=e.instance,this}get jigs(){try{return Array.from(this.refs.values()).filter(t=>t instanceof this.run.constructor.Jig)}catch(t){return this.aavb(),this.jigs}}get code(){try{return Array.from(this.refs.values()).filter(t=>!(t instanceof this.run.constructor.Jig))}catch(t){return this.aavb(),this.code}}aavb(){const t=[];for(const[e,r]of this.refs)try{this.run.constructor.Jig}catch(r){t.push(e)}t.forEach(t=>this.refs.delete(t))}async sync(){return await this.run.aasc.sync(),this._query||(this._query=new Promise((t,e)=>{this.aaub().then(t).catch(e)}).finally(()=>{this._query=null})),this._query}async aaub(){const t=await this.run.blockchain.utxos(this.bsvAddress),e=new Map,r=new Map;for(const[t,n]of this.refs){"string"!=typeof t&&e.set(t,n);try{r.set(n.location,n)}catch(t){}}for(const n of t){const t=`${n.txid}_o${n.vout}`,s=r.get(t);if(s){e.delete(s),e.set(t,s);continue}const i=await this.run.blockchain.fetch(n.txid),a=o.aai(i,n.vout);if("jig"===a||"code"===a)try{const r=await this.run.load(t);e.set(r.origin,r)}catch(t){}}this.refs=e}aawb(t){if(this.refs.delete(t),t.owner===this.pubkey)try{if(void 0===t.origin)throw new Error;if(t.origin.startsWith("_"))throw new Error;this.refs.set(t.origin,t)}catch(e){this.refs.set(t,t)}else try{this.refs.delete(t.origin)}catch(t){}}}},function(t,e,r){const{Jig:Jig}=r(1);class Token extends Jig{init(t,e,r){if(this.constructor===Token)throw new Error("Token must be extended");if(void 0!==e){if("object"!=typeof e)throw new Error("bad token type");if(e.constructor!==this.constructor)throw new Error("bad token class");return this._checkAmount(t),e._decreaseAmount(t),void(this.amount=t)}if(void 0!==r){if(r.length<2)throw new Error("must combine at least two tokens");if(r.some(t=>t.constructor!==this.constructor))throw new Error("cannot combine different token classes");const t=t=>r.reduce((e,r)=>r===t?e+1:e,0);if(r.some(e=>t(e)>1))throw new Error("cannot combine duplicate tokens");return this.amount=0,r.forEach(t=>{this.amount+=t.amount,t._destroy()}),void this._checkAmount(this.amount)}if(this._checkAmount(t),this.owner!==this.constructor.owner)throw new Error(`Only ${this.constructor.name}'s owner may mint`);this.amount=t,this._onMint(t,caller)}send(t,e){if(e=void 0===e?this.amount:e,this._checkAmount(e),e>this.amount)throw new Error("not enough funds");if(this.amount===e)return this.owner=t,null;const r=new this.constructor(this.amount-e,this);return this.owner=t,r}get value(){let t=this.amount;for(let e=0;e<this.constructor.decimals;e++)t/=10;return t}static combine(...t){return new this(void 0,void 0,t)}_destroy(){this.amount=0,this.owner="029d11c250cc84a6ffbaf84fc28da82fc4deee214021bed2dcaa22d5193d22e273"}_decreaseAmount(t){this.amount-=t}_checkAmount(t){if("number"!=typeof t)throw new Error("amount is not a number");if(t<=0)throw new Error("amount must be positive");if(t>Number.MAX_SAFE_INTEGER)throw new Error("amount too large");if(!Number.isInteger(t))throw new Error("amount must be an integer")}_onMint(t,e){}}Token.decimals=0,Token.originTestnet="ef7e1b87a6357a20a3ff0149a49814d528e7a53a38794b2aaa843eda8750bbc6_o1",Token.locationTestnet="ef7e1b87a6357a20a3ff0149a49814d528e7a53a38794b2aaa843eda8750bbc6_o1",Token.ownerTestnet="024809cae5f1d22347781ff55652a945bb1b3239022bad13e689ec5f0fd942a01a",Token.originMainnet="5cf01e91c656a316b3d366464f80fafeadce81e0283cc74e10e2f9e382013e5a_o1",Token.locationMainnet="5cf01e91c656a316b3d366464f80fafeadce81e0283cc74e10e2f9e382013e5a_o1",Token.ownerMainnet="032fcd67819a099330cf7ebf358e63925d00839d6094d3df10126371904d1fe1b9",t.exports=Token}]);